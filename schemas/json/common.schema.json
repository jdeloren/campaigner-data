{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "common.schema.json",
  "title": "Common D&D 5e Schema Definitions",
  "description": "Shared definitions used across all D&D 5e data schemas",
  "$defs": {
    "Ability": {
      "enum": ["Strength", "Dexterity", "Constitution", "Intelligence", "Wisdom", "Charisma"],
      "title": "Ability",
      "type": "string"
    },
    "AbilityCheckRequirement": {
      "description": "Requirement based on ability check context.",
      "properties": {
        "type": {
          "const": "ability_check",
          "default": "ability_check",
          "title": "Type",
          "type": "string"
        },
        "ability": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Ability/abilities the check must use",
          "title": "Ability"
        },
        "proficient": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether check must be proficient",
          "title": "Proficient"
        },
        "check_type": {
          "anyOf": [
            {
              "enum": ["raw", "skill"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether this is a raw ability check or skill-based",
          "title": "Check Type"
        }
      },
      "title": "AbilityCheckRequirement",
      "type": "object"
    },
    "AbilityModifierOperand": {
      "description": "An ability score modifier.",
      "properties": {
        "type": {
          "const": "ability_modifier",
          "default": "ability_modifier",
          "title": "Type",
          "type": "string"
        },
        "ability": {
          "description": "Ability score (e.g., 'Strength', 'Charisma')",
          "title": "Ability",
          "type": "string"
        }
      },
      "required": ["ability"],
      "title": "AbilityModifierOperand",
      "type": "object"
    },
    "ActionModifierOperand": {
      "description": "An ability modifier resolved from action context (e.g., spellcasting class, weapon attack).",
      "properties": {
        "type": {
          "const": "action_modifier",
          "default": "action_modifier",
          "title": "Type",
          "type": "string"
        },
        "modifier": {
          "description": "Modifier type to resolve (e.g., 'spellcasting', 'attack')",
          "title": "Modifier",
          "type": "string"
        }
      },
      "required": ["modifier"],
      "title": "ActionModifierOperand",
      "type": "object"
    },
    "ActionConstraint": {
      "description": "Action restriction applied on the target's turn.\n\nUse blocked_actions to deny specific action types.\nUse allowed_actions to restrict to ONLY the listed actions.\n\nExample \u2014 Turn Undead:\n{\"blocked_actions\": [\"reaction\"], \"allowed_actions\": [\"Dash\", \"Dodge\"]}",
      "properties": {
        "blocked_actions": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Action types or specific actions the target cannot use (e.g., 'reaction', 'cast_spell')",
          "title": "Blocked Actions"
        },
        "allowed_actions": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "If set, the ONLY actions the target can take",
          "title": "Allowed Actions"
        }
      },
      "title": "ActionConstraint",
      "type": "object"
    },
    "Activation": {
      "description": "Defines how a mechanic is activated.",
      "properties": {
        "type": {
          "$ref": "#/$defs/ActivationType",
          "description": "Type of activation"
        },
        "trigger": {
          "anyOf": [
            {
              "$ref": "#/$defs/Trigger"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "For reactions: what triggers this ability"
        }
      },
      "required": ["type"],
      "title": "Activation",
      "type": "object"
    },
    "ActivationType": {
      "description": "Types of activation for a mechanic.",
      "enum": ["passive", "action", "bonus_action", "reaction", "free_action", "choice"],
      "title": "ActivationType",
      "type": "string"
    },
    "AdvantageEffect": {
      "description": "Advantage effect on rolls.\n\nUse exactly one of: ability, skill, attack, saving_throw, initiative.",
      "properties": {
        "ability": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Raw ability check (e.g., 'Strength')",
          "title": "Ability"
        },
        "skill": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Skill check (e.g., 'Stealth', 'Perception')",
          "title": "Skill"
        },
        "attack": {
          "anyOf": [
            {
              "enum": ["all", "melee", "ranged"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Attack rolls \u2014 'all', 'melee', or 'ranged'",
          "title": "Attack"
        },
        "saving_throw": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Saving throws for specific abilities (e.g., ['Dexterity'] or all six for 'all saves')",
          "title": "Saving Throw"
        },
        "initiative": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Initiative rolls",
          "title": "Initiative"
        },
        "against": {
          "anyOf": [
            {
              "$ref": "#/$defs/Against"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "For attacks, who the attack targets"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/Target"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target of the effect (e.g., {'type': 'attacker'}, {'type': 'attackers'})"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions for the advantage to apply",
          "title": "Requirements"
        },
        "count": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Number of uses (e.g., 1 for next attack only)",
          "title": "Count"
        },
        "duration": {
          "anyOf": [
            {
              "$ref": "#/$defs/Duration"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How long the advantage lasts"
        }
      },
      "title": "AdvantageEffect",
      "type": "object"
    },
    "AdvantageImmunity": {
      "description": "Immunity to advantage on attacks against the character.\n\nExample \u2014 Elusive (no attack has advantage while not incapacitated):\n{\"category\": \"advantage\", \"event\": \"attack\"}",
      "properties": {
        "category": {
          "const": "advantage",
          "default": "advantage",
          "title": "Category",
          "type": "string"
        },
        "event": {
          "description": "Event the advantage immunity applies to (e.g., 'attack')",
          "title": "Event",
          "type": "string"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions that must be met",
          "title": "Requirements"
        }
      },
      "required": ["event"],
      "title": "AdvantageImmunity",
      "type": "object"
    },
    "Against": {
      "description": "Specifies what the effect applies against (for advantage/disadvantage).",
      "properties": {
        "disposition": {
          "anyOf": [
            {
              "enum": ["friendly", "hostile", "any"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Disposition of creatures the effect applies against",
          "title": "Disposition"
        },
        "exclude": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Exclude specific targets from the effect",
          "title": "Exclude"
        },
        "creature_type": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Specific creature types the effect applies against",
          "title": "Creature Type"
        },
        "status": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Status/conditions the save is against (e.g., ['charmed', 'frightened'])",
          "title": "Status"
        },
        "source": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity whose effects this applies against (e.g., 'character' for spells from the caster)",
          "title": "Source"
        },
        "effect_type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Type of effect this applies against (e.g., 'spell')",
          "title": "Effect Type"
        }
      },
      "title": "Against",
      "type": "object"
    },
    "Alignment": {
      "enum": [
        "Lawful Good",
        "Lawful Neutral",
        "Lawful Evil",
        "Neutral Good",
        "Neutral",
        "Neutral Evil",
        "Chaotic Good",
        "Chaotic Neutral",
        "Chaotic Evil"
      ],
      "title": "Alignment",
      "type": "string"
    },
    "ApplyStatus": {
      "description": "Defines a status effect to apply to a target.\n\nThe source and action fields enable tracking WHO applied the status and\nWHAT ability was used, allowing features like Master of Nature to query\nfor creatures charmed by a specific ability.\n\nExample - Charm Animals and Plants:\n{\n    \"name\": \"charmed\",\n    \"source\": \"character\",\n    \"action\": \"Charm Animals and Plants\",\n    \"duration\": {\"value\": 1, \"unit\": \"minutes\"}\n}\n\nExample - Mind control with concentration:\n{\n    \"name\": \"dominated\",\n    \"source\": \"character\",\n    \"action\": \"Dominate Person\",\n    \"concentration\": true\n}",
      "properties": {
        "name": {
          "description": "Name of the status condition",
          "title": "Name",
          "type": "string"
        },
        "source": {
          "anyOf": [
            {
              "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity that applied this status (character, target, etc.)",
          "title": "Source"
        },
        "action": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Name of the feature/ability that applied this status",
          "title": "Action"
        },
        "duration": {
          "anyOf": [
            {
              "$ref": "#/$defs/Duration"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How long the status lasts"
        },
        "concentration": {
          "default": false,
          "description": "Whether maintaining this status requires concentration by the source",
          "title": "Concentration",
          "type": "boolean"
        },
        "modifier": {
          "anyOf": [
            {
              "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity that modifies the effect (e.g., frightened OF character)",
          "title": "Modifier"
        },
        "effect": {
          "anyOf": [
            {
              "$ref": "#/$defs/StatusEffect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Single mechanical effect of this status"
        },
        "effects": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/StatusEffect"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Multiple mechanical effects of this status",
          "title": "Effects"
        },
        "constraints": {
          "anyOf": [
            {
              "$ref": "#/$defs/StatusConstraint"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Behavioral restrictions imposed on the target while this status is active"
        },
        "escape": {
          "anyOf": [
            {
              "$ref": "#/$defs/SavingThrow"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Saving throw to escape this status (costs an action to attempt)"
        }
      },
      "required": ["name"],
      "title": "ApplyStatus",
      "type": "object"
    },
    "Area": {
      "description": "Defines the shape and size of an environmental effect.",
      "properties": {
        "shape": {
          "description": "Shape of the area",
          "enum": ["radius", "sphere", "cube", "cone", "cylinder", "line", "square"],
          "title": "Shape",
          "type": "string"
        },
        "size": {
          "description": "Size of the area in the specified unit",
          "title": "Size",
          "type": "integer"
        },
        "unit": {
          "default": "feet",
          "description": "Unit of measurement",
          "enum": ["feet", "miles"],
          "title": "Unit",
          "type": "string"
        },
        "origin": {
          "default": "point",
          "description": "Where the area originates from",
          "enum": ["self", "target", "point", "caster", "weapon"],
          "title": "Origin",
          "type": "string"
        },
        "height": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Height for 3D shapes like cylinder",
          "title": "Height"
        }
      },
      "required": ["shape", "size"],
      "title": "Area",
      "type": "object"
    },
    "Attack": {
      "description": "Attack roll specification \u2014 source and resolution details.",
      "properties": {
        "source": {
          "anyOf": [
            {
              "$ref": "#/$defs/TriggerSource"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Attack source (e.g., spell, weapon)"
        }
      },
      "title": "Attack",
      "type": "object"
    },
    "AttackRequirement": {
      "description": "Attack-specific requirement.",
      "properties": {
        "type": {
          "const": "attack",
          "default": "attack",
          "title": "Type",
          "type": "string"
        },
        "hand": {
          "anyOf": [
            {
              "enum": ["main_hand", "off_hand"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Which hand the attack is made with",
          "title": "Hand"
        }
      },
      "title": "AttackRequirement",
      "type": "object"
    },
    "AttackResultRequirement": {
      "description": "Requirement based on attack outcome.",
      "properties": {
        "type": {
          "const": "attack_result",
          "default": "attack_result",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Required attack result",
          "enum": ["hit", "miss"],
          "title": "Value",
          "type": "string"
        }
      },
      "required": ["value"],
      "title": "AttackResultRequirement",
      "type": "object"
    },
    "AttributeModification": {
      "description": "A typed modification to a character attribute.\n\nExample \u2014 numeric (set critical hit threshold):\n{\"target\": \"combat.critical_hit_threshold\", \"calculation\": {\"operation\": \"set\", ...}}\n\nExample \u2014 data-driven (grant all languages):\n{\"target\": \"languages\", \"query\": {\"endpoint\": \"languages\"}}",
      "properties": {
        "target": {
          "description": "Dot-notation path to the attribute (e.g., 'combat.critical_hit_threshold', 'movement.base')",
          "title": "Target",
          "type": "string"
        },
        "calculation": {
          "anyOf": [
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Numeric operation to apply to the attribute"
        },
        "query": {
          "anyOf": [
            {
              "$ref": "#/$defs/Query"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Data query whose results populate the attribute"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions that must be met for this modification to apply",
          "title": "Requirements"
        }
      },
      "required": ["target"],
      "title": "AttributeModification",
      "type": "object"
    },
    "AttributeOperand": {
      "description": "A character attribute reference.",
      "properties": {
        "type": {
          "const": "attribute",
          "default": "attribute",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Dot-notation path to attribute",
          "title": "Value",
          "type": "string"
        }
      },
      "required": ["value"],
      "title": "AttributeOperand",
      "type": "object"
    },
    "AttributeRequirement": {
      "description": "Requirement based on an attribute score minimum.",
      "properties": {
        "type": {
          "const": "attribute",
          "default": "attribute",
          "title": "Type",
          "type": "string"
        },
        "attribute": {
          "description": "The attribute required (e.g., 'Strength')",
          "title": "Attribute",
          "type": "string"
        },
        "minimum": {
          "description": "Minimum score required",
          "title": "Minimum",
          "type": "integer"
        }
      },
      "required": ["attribute", "minimum"],
      "title": "AttributeRequirement",
      "type": "object"
    },
    "Aura": {
      "description": "An aura effect that emanates from a source.\n\nUsed for:\n- Lighting auras (Light, Dancing Lights): use `layers`\n- Mechanical auras (Paladin, Barbarian): use `radius`, `target`, `grants`",
      "properties": {
        "origin": {
          "default": "self",
          "description": "Where the aura originates from",
          "enum": ["self", "target", "created", "each_light", "point", "weapon"],
          "title": "Origin",
          "type": "string"
        },
        "radius": {
          "default": 0,
          "description": "Radius for mechanical auras",
          "title": "Radius",
          "type": "integer"
        },
        "unit": {
          "default": "feet",
          "description": "Unit of measurement",
          "enum": ["feet", "miles"],
          "title": "Unit",
          "type": "string"
        },
        "shape": {
          "default": "radius",
          "description": "Shape of the aura",
          "enum": ["radius", "cone", "cube", "sphere", "cylinder", "line"],
          "title": "Shape",
          "type": "string"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/Target"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Who the aura affects"
        },
        "layers": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/AuraLayer"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Light layers from innermost to outermost",
          "title": "Layers"
        },
        "grants": {
          "anyOf": [
            {
              "$ref": "#/$defs/AuraGrant"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Modifier granted to affected creatures"
        }
      },
      "title": "Aura",
      "type": "object"
    },
    "AuraGrant": {
      "description": "Modifier granted to creatures within the aura's area.\n\nExample \u2014 Wolf Totem (advantage on melee attacks for allies):\n{\"advantage\": {\"attack\": \"melee\", \"against\": {\"disposition\": \"hostile\"}}}\n\nExample \u2014 Bear Totemic Attunement (disadvantage on attacks for enemies):\n{\"disadvantage\": {\"attack\": \"all\"}}\n\nExample \u2014 Elk Aspect (doubled travel pace for allies):\n{\"attribute\": {\"target\": \"movement.travel_pace\", \"calculation\": {...}}}",
      "properties": {
        "advantage": {
          "anyOf": [
            {
              "$ref": "#/$defs/AdvantageEffect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Grants advantage to affected creatures"
        },
        "disadvantage": {
          "anyOf": [
            {
              "$ref": "#/$defs/DisadvantageEffect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Imposes disadvantage on affected creatures"
        },
        "attribute": {
          "anyOf": [
            {
              "$ref": "#/$defs/AttributeModification"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Modifies an attribute on affected creatures"
        }
      },
      "title": "AuraGrant",
      "type": "object"
    },
    "AuraLayer": {
      "description": "A single layer of a lighting aura.\n\nAuras can have multiple layers (e.g., bright light inner, dim light outer).",
      "properties": {
        "type": {
          "description": "Type of light this layer produces",
          "enum": ["bright_light", "dim_light", "darkness", "magical_darkness"],
          "title": "Type",
          "type": "string"
        },
        "shape": {
          "default": "radius",
          "description": "Shape of the layer",
          "enum": ["radius", "cone", "cube", "sphere", "cylinder", "line"],
          "title": "Shape",
          "type": "string"
        },
        "size": {
          "description": "Size of the layer in the specified unit",
          "title": "Size",
          "type": "integer"
        },
        "unit": {
          "default": "feet",
          "description": "Unit of measurement",
          "enum": ["feet", "miles"],
          "title": "Unit",
          "type": "string"
        },
        "color": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Color of the light. Use 'choice' for caster-chosen, or specific values like 'fire', 'blue', etc.",
          "title": "Color"
        }
      },
      "required": ["type", "size"],
      "title": "AuraLayer",
      "type": "object"
    },
    "BaseMechanic": {
      "description": "A structured game mechanic for a class feature (all types except 'resource').",
      "properties": {
        "type": {
          "description": "Type of mechanic",
          "enum": [
            "action",
            "bonus_action",
            "reaction",
            "passive",
            "ritual",
            "movement",
            "critical_hit",
            "extra_attack",
            "extra_turn",
            "damage_bonus",
            "advantage",
            "resistance",
            "immunity",
            "optional",
            "special"
          ],
          "title": "Type",
          "type": "string"
        },
        "name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Name of the mechanic",
          "title": "Name"
        },
        "uses": {
          "anyOf": [
            {
              "$ref": "#/$defs/Uses"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Usage limits for this mechanic"
        },
        "limit": {
          "anyOf": [
            {
              "$ref": "#/$defs/ScalingReference"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Reference to a scaling property for level-based usage limits"
        },
        "recharge": {
          "anyOf": [
            {
              "$ref": "#/$defs/RechargeType"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "When the resource recharges"
        },
        "scaling": {
          "anyOf": [
            {
              "$ref": "#/$defs/Scaling"
            },
            {
              "additionalProperties": {
                "$ref": "#/$defs/Scaling"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How the mechanic scales with level. Can be a single Scaling or named scaling properties.",
          "title": "Scaling"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Requirements that must be met for this mechanic to apply",
          "title": "Requirements"
        },
        "suggested": {
          "default": false,
          "description": "Whether this is a suggested interpretation vs explicit",
          "title": "Suggested",
          "type": "boolean"
        },
        "concentration": {
          "default": false,
          "description": "Whether this mechanic requires concentration",
          "title": "Concentration",
          "type": "boolean"
        },
        "ends_spell": {
          "default": false,
          "description": "Whether activating this mechanic terminates the spell",
          "title": "Ends Spell",
          "type": "boolean"
        },
        "activation": {
          "anyOf": [
            {
              "$ref": "#/$defs/Activation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How this mechanic is activated"
        },
        "trigger": {
          "anyOf": [
            {
              "$ref": "#/$defs/Trigger"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Event that triggers this mechanic"
        },
        "grants": {
          "anyOf": [
            {
              "$ref": "#/$defs/Grant"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Action or ability granted by this mechanic"
        },
        "effects": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/Effect"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Effects applied by this mechanic",
          "title": "Effects"
        },
        "max_active_effects": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum number of effects from this mechanic that can be active simultaneously",
          "title": "Max Active Effects"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/Target"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Who or what this mechanic targets"
        },
        "area": {
          "anyOf": [
            {
              "$ref": "#/$defs/Area"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Area of effect"
        },
        "damage": {
          "anyOf": [
            {
              "$ref": "#/$defs/Damage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Damage dealt by this mechanic"
        },
        "saving_throw": {
          "anyOf": [
            {
              "$ref": "#/$defs/SavingThrow"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Saving throw required by this mechanic"
        },
        "on_failure": {
          "anyOf": [
            {
              "$ref": "#/$defs/Effect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What happens on a failed save"
        },
        "on_success": {
          "anyOf": [
            {
              "$ref": "#/$defs/Effect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What happens on a successful save"
        },
        "cost": {
          "anyOf": [
            {
              "items": {
                "anyOf": [
                  {
                    "$ref": "common.schema.json#/$defs/CurrencyCost"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/ResourceCost"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Resource or currency costs to use this mechanic",
          "title": "Cost"
        },
        "duration": {
          "anyOf": [
            {
              "$ref": "#/$defs/Duration"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How long the mechanic's effects last"
        },
        "range": {
          "anyOf": [
            {
              "$ref": "#/$defs/Distance"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Range of the mechanic"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Descriptive text for this mechanic",
          "title": "Description"
        }
      },
      "required": ["type"],
      "title": "BaseMechanic",
      "type": "object"
    },
    "BlockedBy": {
      "description": "What blocks an effect or detection from reaching its target.\n\nExample \u2014 Radiance of the Dawn (blocked by total cover):\n{\"cover\": \"total\"}\n\nExample \u2014 Detect Magic (blocked by material barriers):\n{\"barriers\": [\"1 foot of stone\", \"1 inch of common metal\", \"a thin sheet of lead\"]}",
      "properties": {
        "cover": {
          "anyOf": [
            {
              "enum": ["none", "half", "three_quarters", "total"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Minimum cover level that blocks the effect",
          "title": "Cover"
        },
        "barriers": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Materials or barriers that block the effect",
          "title": "Barriers"
        }
      },
      "title": "BlockedBy",
      "type": "object"
    },
    "BooleanOperand": {
      "description": "A static boolean value.",
      "properties": {
        "type": {
          "const": "boolean",
          "default": "boolean",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Boolean value",
          "title": "Value",
          "type": "boolean"
        }
      },
      "required": ["value"],
      "title": "BooleanOperand",
      "type": "object"
    },
    "Calculation": {
      "description": "Pure math operation that produces a value.\n\nContext from the trigger or mechanic type determines what the result modifies.",
      "properties": {
        "operation": {
          "description": "Math operation to perform",
          "enum": ["add", "subtract", "multiply", "divide", "max", "min", "set"],
          "title": "Operation",
          "type": "string"
        },
        "operators": {
          "description": "Operands for the calculation",
          "items": {
            "discriminator": {
              "mapping": {
                "ability_modifier": "#/$defs/AbilityModifierOperand",
                "action_modifier": "#/$defs/ActionModifierOperand",
                "attribute": "#/$defs/AttributeOperand",
                "boolean": "#/$defs/BooleanOperand",
                "class_level": "#/$defs/ClassLevelOperand",
                "dice": "#/$defs/DiceOperand",
                "function": "#/$defs/FunctionOperand",
                "integer": "#/$defs/IntegerOperand",
                "resource_die": "#/$defs/ResourceDieOperand",
                "roll_result": "#/$defs/RollResultOperand",
                "scaling": "#/$defs/ScalingOperand",
                "spell_level_cast": "#/$defs/SpellLevelCastOperand",
                "string": "#/$defs/StringOperand"
              },
              "propertyName": "type"
            },
            "oneOf": [
              {
                "$ref": "#/$defs/IntegerOperand"
              },
              {
                "$ref": "#/$defs/BooleanOperand"
              },
              {
                "$ref": "#/$defs/StringOperand"
              },
              {
                "$ref": "#/$defs/DiceOperand"
              },
              {
                "$ref": "#/$defs/AttributeOperand"
              },
              {
                "$ref": "#/$defs/ResourceDieOperand"
              },
              {
                "$ref": "#/$defs/AbilityModifierOperand"
              },
              {
                "$ref": "#/$defs/ActionModifierOperand"
              },
              {
                "$ref": "#/$defs/FunctionOperand"
              },
              {
                "$ref": "#/$defs/RollResultOperand"
              },
              {
                "$ref": "#/$defs/ClassLevelOperand"
              },
              {
                "$ref": "#/$defs/SpellLevelCastOperand"
              },
              {
                "$ref": "#/$defs/ScalingOperand"
              }
            ]
          },
          "title": "Operators",
          "type": "array"
        },
        "rounding": {
          "anyOf": [
            {
              "enum": ["up", "down"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Rounding direction for divide",
          "title": "Rounding"
        }
      },
      "required": ["operation", "operators"],
      "title": "Calculation",
      "type": "object"
    },
    "Chain": {
      "description": "Chaining behavior when an effect jumps to an additional target.\n\nCovers both conditional chaining (Chaos Bolt \u2014 leaps on matching d8s)\nand secondary targeting (Sweeping Attack \u2014 transfers the attack roll).\n\nExample \u2014 Chaos Bolt:\n{\"condition\": {\"size\": 8, \"check\": \"matching\"},\n \"range\": {\"value\": 30, \"unit\": \"feet\"}}\n\nExample \u2014 Sweeping Attack:\n{\"range\": {\"value\": 5, \"unit\": \"feet\"}, \"inherit\": true,\n \"damage\": {\"value\": \"superiority_die\", \"inherit_type\": true}}",
      "properties": {
        "condition": {
          "anyOf": [
            {
              "$ref": "#/$defs/DiceCondition"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dice-based condition that triggers the chain"
        },
        "range": {
          "anyOf": [
            {
              "$ref": "#/$defs/Distance"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum distance from original target to chain target"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/Target"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Additional constraints on the chain target"
        },
        "inherit": {
          "default": false,
          "description": "Reuse the triggering attack roll against the new target",
          "title": "Inherit",
          "type": "boolean"
        },
        "attack": {
          "anyOf": [
            {
              "$ref": "#/$defs/Attack"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Make a fresh attack roll against the chain target"
        },
        "damage": {
          "anyOf": [
            {
              "$ref": "#/$defs/Damage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Damage dealt to the chain target (if different from parent effect)"
        }
      },
      "title": "Chain",
      "type": "object"
    },
    "Choice": {
      "description": "Player choice within an effect.\n\nSupports named options (with or without effects), typed selections\n(damage type), and external source references (skill/tool proficiency).\n\nExample \u2014 Chromatic Orb:\n{\"type\": \"damage_type\", \"options\": [{\"name\": \"acid\"}, {\"name\": \"cold\"}, ...]}\n\nExample \u2014 Hex:\n{\"options\": [{\"name\": \"Strength\"}, {\"name\": \"Dexterity\"}, ...]}\n\nExample \u2014 Knowledge of the Ages:\n{\"source\": \"skills_and_tools\", \"count\": 1}",
      "properties": {
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Classifier for the choice (e.g., 'damage_type')",
          "title": "Type"
        },
        "options": {
          "anyOf": [
            {
              "items": {
                "type": "object"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Available options to choose from",
          "title": "Options"
        },
        "source": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "External source to draw options from (e.g., 'skills_and_tools')",
          "title": "Source"
        },
        "count": {
          "default": 1,
          "description": "Number of options to choose",
          "title": "Count",
          "type": "integer"
        }
      },
      "title": "Choice",
      "type": "object"
    },
    "ChoiceMechanic": {
      "description": "A character-building choice mechanic (type='choice').",
      "properties": {
        "type": {
          "const": "choice",
          "description": "Must be 'choice'",
          "title": "Type",
          "type": "string"
        },
        "choice_type": {
          "anyOf": [
            {
              "$ref": "#/$defs/ChoiceType"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What kind of choice (skill, language, feat, etc.). Optional when using nested ChoiceOption objects."
        },
        "options": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "simple": "#/$defs/SimpleChoiceOption",
                    "nested": "#/$defs/NestedChoiceOption",
                    "trait_ref": "#/$defs/TraitRefChoiceOption"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/SimpleChoiceOption"
                  },
                  {
                    "$ref": "#/$defs/NestedChoiceOption"
                  },
                  {
                    "$ref": "#/$defs/TraitRefChoiceOption"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of choice options. Each option has type 'simple' (named value) or 'nested' (triggers sub-choice).",
          "title": "Options"
        },
        "options_ref": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Reference to a sibling key containing the options (e.g., 'subfeatures')",
          "title": "Options Ref"
        },
        "count": {
          "default": 1,
          "description": "How many to pick",
          "title": "Count",
          "type": "integer"
        },
        "name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Name of the choice mechanic",
          "title": "Name"
        },
        "query": {
          "anyOf": [
            {
              "$ref": "#/$defs/Query"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Data query for choice_type='query'"
        },
        "effects": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/Effect"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Effects applied by the choice",
          "title": "Effects"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Requirements that must be met",
          "title": "Requirements"
        },
        "scaling": {
          "anyOf": [
            {
              "$ref": "#/$defs/Scaling"
            },
            {
              "additionalProperties": {
                "$ref": "#/$defs/Scaling"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How the choice scales with level",
          "title": "Scaling"
        },
        "unique": {
          "default": false,
          "description": "Whether selections must be unique (no duplicates allowed)",
          "title": "Unique",
          "type": "boolean"
        },
        "value": {
          "anyOf": [
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Value calculation to apply with selection (e.g., +1 for ability score increases)",
          "title": "Value"
        }
      },
      "required": ["type"],
      "title": "ChoiceMechanic",
      "type": "object"
    },
    "SimpleChoiceOption": {
      "description": "A simple named option (e.g., skill name, language).\n\nExample: {\"type\": \"simple\", \"name\": \"Stealth\"}",
      "properties": {
        "type": {
          "const": "simple",
          "default": "simple",
          "title": "Type",
          "type": "string"
        },
        "name": {
          "description": "Option name/value",
          "title": "Name",
          "type": "string"
        }
      },
      "required": ["type", "name"],
      "title": "SimpleChoiceOption",
      "type": "object"
    },
    "NestedChoiceOption": {
      "description": "An option that triggers a nested choice (e.g., ASI branches).\n\nExample: {\"type\": \"nested\", \"name\": \"Gain a Feat\", \"choice\": {\"choice_type\": \"feat\", \"count\": 1}}",
      "properties": {
        "type": {
          "const": "nested",
          "default": "nested",
          "title": "Type",
          "type": "string"
        },
        "name": {
          "description": "Display name of the option",
          "title": "Name",
          "type": "string"
        },
        "choice": {
          "$ref": "#/$defs/NestedChoice",
          "description": "The nested choice to present when this option is selected"
        }
      },
      "required": ["type", "name", "choice"],
      "title": "NestedChoiceOption",
      "type": "object"
    },
    "TraitRefChoiceOption": {
      "description": "A reference to a trait on another race, resolved at runtime.\n\nExample: {\"type\": \"trait_ref\", \"race\": \"High Elf\", \"trait\": \"Elf Weapon Training\"}",
      "properties": {
        "type": {
          "const": "trait_ref",
          "default": "trait_ref",
          "title": "Type",
          "type": "string"
        },
        "race": {
          "description": "Name of the race that owns this trait",
          "title": "Race",
          "type": "string"
        },
        "trait": {
          "description": "Name of the trait on the referenced race",
          "title": "Trait",
          "type": "string"
        }
      },
      "required": ["type", "race", "trait"],
      "title": "TraitRefChoiceOption",
      "type": "object"
    },
    "ChoiceType": {
      "description": "Valid choice_type values for type='choice' mechanics.",
      "enum": [
        "skill",
        "language",
        "subclass",
        "subfeature",
        "spell",
        "equipment",
        "expertise",
        "query",
        "feat",
        "ability_score",
        "tool",
        "trait"
      ],
      "title": "ChoiceType",
      "type": "string"
    },
    "ClassLevelOperand": {
      "description": "A class level value.",
      "properties": {
        "type": {
          "const": "class_level",
          "default": "class_level",
          "title": "Type",
          "type": "string"
        },
        "class": {
          "description": "Class name",
          "title": "Class",
          "type": "string"
        }
      },
      "required": ["class"],
      "title": "ClassLevelOperand",
      "type": "object"
    },
    "CombatStateRequirement": {
      "description": "Requirement based on combat state.",
      "properties": {
        "type": {
          "const": "combat_state",
          "default": "combat_state",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Combat state that must be active",
          "enum": ["surprised", "hidden", "engaged", "flanking"],
          "title": "Value",
          "type": "string"
        },
        "negate": {
          "default": false,
          "description": "If true, state must NOT be active",
          "title": "Negate",
          "type": "boolean"
        }
      },
      "required": ["value"],
      "title": "CombatStateRequirement",
      "type": "object"
    },
    "CountRequirement": {
      "description": "Requirement based on the count of active instances (e.g., max bonded weapons).",
      "properties": {
        "type": {
          "const": "count",
          "default": "count",
          "title": "Type",
          "type": "string"
        },
        "status": {
          "description": "Status to count instances of",
          "title": "Status",
          "type": "string"
        },
        "max": {
          "description": "Maximum allowed count",
          "title": "Max",
          "type": "integer"
        }
      },
      "required": ["status", "max"],
      "title": "CountRequirement",
      "type": "object"
    },
    "CreatureSize": {
      "enum": ["Tiny", "Small", "Medium", "Large", "Huge", "Gargantuan"],
      "title": "CreatureSize",
      "type": "string"
    },
    "CreatureTypeRequirement": {
      "description": "Creature type requirement \u2014 filter targets by creature type.",
      "properties": {
        "type": {
          "const": "creature_type",
          "default": "creature_type",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "description": "Creature type(s) to match (e.g., 'Undead', ['Construct', 'Undead'])",
          "title": "Value"
        },
        "negate": {
          "default": false,
          "description": "If true, creature must NOT be this type",
          "title": "Negate",
          "type": "boolean"
        }
      },
      "required": ["value"],
      "title": "CreatureTypeRequirement",
      "type": "object"
    },
    "Currency": {
      "enum": ["CP", "SP", "EP", "GP", "PP"],
      "title": "Currency",
      "type": "string"
    },
    "CurrencyCost": {
      "description": "Cost in currency.\n\nExample: {\"amount\": 50, \"currency\": \"GP\"}",
      "properties": {
        "amount": {
          "description": "Numeric cost",
          "title": "Amount",
          "type": "number"
        },
        "currency": {
          "$ref": "common.schema.json#/$defs/Currency",
          "description": "Currency: CP, SP, EP, GP, PP"
        }
      },
      "required": ["amount", "currency"],
      "title": "CurrencyCost",
      "type": "object"
    },
    "Damage": {
      "description": "Damage specification \u2014 dice, type, and modifiers.",
      "properties": {
        "dice": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dice expression, reference, or flat value",
          "title": "Dice"
        },
        "type": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Damage type(s)",
          "title": "Type"
        },
        "bonus": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Flat numeric bonus or calculated bonus (e.g., class level, ability modifier)",
          "title": "Bonus"
        },
        "source": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Damage source: 'weapon' or 'spell'",
          "title": "Source"
        },
        "auto_hit": {
          "default": false,
          "description": "Damage bypasses attack roll",
          "title": "Auto Hit",
          "type": "boolean"
        },
        "conditional": {
          "default": false,
          "description": "Damage only applies if condition met",
          "title": "Conditional",
          "type": "boolean"
        },
        "target": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target qualifier (e.g., 'area')",
          "title": "Target"
        },
        "value": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dynamic damage value reference (e.g., 'superiority_die')",
          "title": "Value"
        },
        "inherit_type": {
          "default": false,
          "description": "Use the triggering attack's damage type instead of an explicit type list",
          "title": "Inherit Type",
          "type": "boolean"
        },
        "calculation": {
          "anyOf": [
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Complex damage calculation (e.g., multiply by 2)"
        }
      },
      "title": "Damage",
      "type": "object"
    },
    "DamageElement": {
      "description": "Elemental/magical damage types.",
      "enum": ["acid", "cold", "fire", "force", "lightning", "necrotic", "poison", "psychic", "radiant", "thunder"],
      "title": "DamageElement",
      "type": "string"
    },
    "DamageResponse": {
      "description": "Damage response modifier: resistance, immunity, or vulnerability to damage types.",
      "properties": {
        "category": {
          "default": "resistance",
          "description": "Type of damage response: resistance, immunity, or vulnerability",
          "enum": ["resistance", "immunity", "vulnerability"],
          "title": "Category",
          "type": "string"
        },
        "to": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Explicit damage types affected (e.g., ['bludgeoning', 'piercing', 'slashing'])",
          "title": "To"
        },
        "match": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Contextual binding to a damage type from the triggering event (e.g., 'trigger.damage_type')",
          "title": "Match"
        },
        "source": {
          "anyOf": [
            {
              "$ref": "#/$defs/DamageResponseSource"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Constraint on the damage source (e.g., weapon attacks)"
        },
        "damage_source_requirements": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/DamageSourceRequirement"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Requirements on the damage source (e.g., nonmagical)",
          "title": "Damage Source Requirements"
        }
      },
      "title": "DamageResponse",
      "type": "object"
    },
    "DamageResponseSource": {
      "description": "Constraint on where the damage comes from (e.g., weapon attacks).",
      "properties": {
        "type": {
          "description": "Source types (e.g., ['weapon'])",
          "items": {
            "type": "string"
          },
          "title": "Type",
          "type": "array"
        }
      },
      "required": ["type"],
      "title": "DamageResponseSource",
      "type": "object"
    },
    "DamageSourceRequirement": {
      "description": "Requirement on the source of damage (e.g., nonmagical attacks).",
      "properties": {
        "type": {
          "const": "damage_source",
          "default": "damage_source",
          "description": "Requirement type",
          "title": "Type",
          "type": "string"
        },
        "property": {
          "description": "Property to check on the damage source (e.g., 'magical')",
          "title": "Property",
          "type": "string"
        },
        "value": {
          "description": "Expected value of the property",
          "title": "Value",
          "type": "boolean"
        }
      },
      "required": ["property", "value"],
      "title": "DamageSourceRequirement",
      "type": "object"
    },
    "DamageTarget": {
      "enum": ["area", "single"],
      "title": "DamageTarget",
      "type": "string"
    },
    "DamageType": {
      "description": "Physical damage types.",
      "enum": ["bludgeoning", "piercing", "slashing", "falling"],
      "title": "DamageType",
      "type": "string"
    },
    "Detection": {
      "description": "Detection \u2014 covers both granting awareness and discoverability.\n\nFor granting awareness (Detect Magic):\n{\"range\": ..., \"detects\": [\"magic\"], \"details\": [\"school_of_magic\"]}\n\nFor discoverability (Snare trap):\n{\"check\": {\"skill\": \"Investigation\", \"dc\": {\"ref\": \"spell_save_dc\"}}}",
      "properties": {
        "range": {
          "anyOf": [
            {
              "$ref": "#/$defs/Distance"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Detection range"
        },
        "detects": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What can be detected (creature types, magic, etc.)",
          "title": "Detects"
        },
        "details": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Additional info revealed (e.g., 'school_of_magic', 'identify_kind')",
          "title": "Details"
        },
        "check": {
          "anyOf": [
            {
              "$ref": "#/$defs/SkillCheck"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Skill check required to detect this effect"
        },
        "ignores_status": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Statuses that don't block this detection (e.g., 'invisible')",
          "title": "Ignores Status"
        },
        "blocked_by": {
          "anyOf": [
            {
              "$ref": "#/$defs/BlockedBy"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What blocks this detection from reaching targets"
        }
      },
      "title": "Detection",
      "type": "object"
    },
    "DiceCondition": {
      "description": "Condition based on dice results from the triggering roll.\n\nExample \u2014 Chaos Bolt (chain on matching d8s):\n{\"dice_sides\": 8, \"check\": \"matching\"}",
      "properties": {
        "dice_sides": {
          "description": "Die size to examine (e.g., 8 for d8)",
          "title": "Dice Sides",
          "type": "integer"
        },
        "check": {
          "const": "matching",
          "description": "Condition to check on the dice of this size",
          "title": "Check",
          "type": "string"
        }
      },
      "required": ["dice_sides", "check"],
      "title": "DiceCondition",
      "type": "object"
    },
    "DiceOperand": {
      "description": "A dice expression to roll.",
      "properties": {
        "type": {
          "const": "dice",
          "default": "dice",
          "title": "Type",
          "type": "string"
        },
        "dice": {
          "description": "Dice expression (e.g., '1d6', '2d8+4')",
          "title": "Dice",
          "type": "string"
        }
      },
      "required": ["dice"],
      "title": "DiceOperand",
      "type": "object"
    },
    "DifficultyClass": {
      "description": "Defines how a saving throw DC is calculated.\n\nUse `ref` for named formulas (e.g., 'spell_save_dc').\nUse `base` with optional `add` and `ability` for inline calculations.\nUse `per_use` for DCs that escalate with each use.",
      "properties": {
        "ref": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Named DC formula (e.g., 'spell_save_dc')",
          "title": "Ref"
        },
        "base": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Base DC value",
          "title": "Base"
        },
        "add": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Reference to add to base (usually 'profienciency_bonus')",
          "title": "Add"
        },
        "ability": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of abilities to pick the highest modifier from",
          "title": "Ability"
        },
        "per_use": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Amount DC increases per use",
          "title": "Per Use"
        }
      },
      "title": "DifficultyClass",
      "type": "object"
    },
    "DisadvantageEffect": {
      "description": "Disadvantage effect on rolls.\n\nUse exactly one of: ability, skill, attack, saving_throw, initiative.",
      "properties": {
        "ability": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Raw ability check (e.g., 'Strength')",
          "title": "Ability"
        },
        "skill": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Skill check (e.g., 'Stealth', 'Perception')",
          "title": "Skill"
        },
        "attack": {
          "anyOf": [
            {
              "enum": ["all", "melee", "ranged"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Attack rolls \u2014 'all', 'melee', or 'ranged'",
          "title": "Attack"
        },
        "saving_throw": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Saving throws for specific abilities",
          "title": "Saving Throw"
        },
        "initiative": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Initiative rolls",
          "title": "Initiative"
        },
        "against": {
          "anyOf": [
            {
              "$ref": "#/$defs/Against"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "For attacks, who the attack targets"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/Target"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target of the effect (e.g., {'type': 'attacker'}, {'type': 'attackers'})"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions for the disadvantage to apply",
          "title": "Requirements"
        },
        "count": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Number of uses",
          "title": "Count"
        },
        "duration": {
          "anyOf": [
            {
              "$ref": "#/$defs/Duration"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How long the disadvantage lasts"
        }
      },
      "title": "DisadvantageEffect",
      "type": "object"
    },
    "DisadvantageImmunity": {
      "description": "Immunity to disadvantage on a specific skill or check.",
      "properties": {
        "category": {
          "const": "disadvantage",
          "default": "disadvantage",
          "title": "Category",
          "type": "string"
        },
        "skill": {
          "description": "Skill immune to disadvantage on (e.g., 'Perception')",
          "title": "Skill",
          "type": "string"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions that must be met",
          "title": "Requirements"
        }
      },
      "required": ["skill"],
      "title": "DisadvantageImmunity",
      "type": "object"
    },
    "Distance": {
      "description": "A distance measurement \u2014 used for ranges, movement distances, and area constraints.",
      "properties": {
        "type": {
          "anyOf": [
            {
              "const": "touch",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Qualitative range type (touch). Mutually exclusive with value.",
          "title": "Type"
        },
        "value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Numeric distance in the given unit (e.g., 60)",
          "title": "Value"
        },
        "unit": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Unit of measurement (e.g., 'feet', 'miles')",
          "title": "Unit"
        },
        "calculation": {
          "anyOf": [
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Computed distance (e.g., half movement speed)"
        },
        "maximum": {
          "default": false,
          "description": "Whether this is a maximum ('up to') distance",
          "title": "Maximum",
          "type": "boolean"
        }
      },
      "title": "Distance",
      "type": "object"
    },
    "DistanceRequirement": {
      "description": "Requirement based on distance.",
      "properties": {
        "type": {
          "const": "distance",
          "default": "distance",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Distance value",
          "title": "Value",
          "type": "integer"
        },
        "unit": {
          "default": "feet",
          "description": "Distance unit",
          "enum": ["feet", "miles"],
          "title": "Unit",
          "type": "string"
        },
        "to": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Reference point (e.g., 'character')",
          "title": "To"
        },
        "comparison": {
          "anyOf": [
            {
              "enum": ["within", "greater_than", "less_than"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Comparison type",
          "title": "Comparison"
        }
      },
      "required": ["value"],
      "title": "DistanceRequirement",
      "type": "object"
    },
    "Distribution": {
      "description": "Rolled budget distributed across targets in ascending order of a resource.\n\nRoll dice to determine a total. Targets are processed in ascending order\nof the specified resource, subtracting each target's value until exhausted.\n\nExample \u2014 Color Spray (6d10 HP budget, blinds targets):\n{\"dice\": \"6d10\", \"resource\": \"hp\"}\n\nExample \u2014 Sleep (5d8 HP budget, puts targets to sleep):\n{\"dice\": \"5d8\", \"resource\": \"hp\"}",
      "properties": {
        "dice": {
          "description": "Dice to roll for the budget total (e.g., '6d10', '5d8')",
          "title": "Dice",
          "type": "string"
        },
        "resource": {
          "description": "Target attribute to spend against (e.g., 'hp')",
          "title": "Resource",
          "type": "string"
        }
      },
      "required": ["dice", "resource"],
      "title": "Distribution",
      "type": "object"
    },
    "Duration": {
      "description": "Duration specification for effects, statuses, and mechanics.\n\nSupports multiple patterns:\n- Fixed: {\"value\": 1, \"unit\": \"turns\"}\n- With timing: {\"value\": 1, \"unit\": \"turns\", \"timing\": \"start\"}\n- Event-based ending: {\"until\": [\"move_end\"]}\n- Combined: {\"value\": 1, \"unit\": \"minutes\", \"until\": [\"attack\", \"cast_spell\"]}",
      "properties": {
        "value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Duration value",
          "title": "Value"
        },
        "unit": {
          "anyOf": [
            {
              "enum": ["turns", "rounds", "minutes", "hours", "days"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Duration unit",
          "title": "Unit"
        },
        "timing": {
          "anyOf": [
            {
              "enum": ["start", "end"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "When in the turn the duration expires",
          "title": "Timing"
        },
        "until": {
          "anyOf": [
            {
              "items": {
                "anyOf": [
                  {
                    "$ref": "#/$defs/TriggerEvent"
                  },
                  {
                    "$ref": "#/$defs/Trigger"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Game events that end the duration early. Use bare TriggerEvent for simple cases, Trigger for events needing context.",
          "title": "Until"
        },
        "sustain": {
          "anyOf": [
            {
              "items": {
                "anyOf": [
                  {
                    "$ref": "#/$defs/TriggerEvent"
                  },
                  {
                    "$ref": "#/$defs/Trigger"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Game events that must fire each turn to keep the effect active. If none fire, the duration ends.",
          "title": "Sustain"
        }
      },
      "title": "Duration",
      "type": "object"
    },
    "Effect": {
      "description": "A single effect within a mechanic.\n\nExtends BaseEffect with mechanic-specific fields for targeting, resolution,\nand complex payloads.",
      "properties": {
        "advantage": {
          "anyOf": [
            {
              "$ref": "#/$defs/AdvantageEffect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Grants advantage"
        },
        "disadvantage": {
          "anyOf": [
            {
              "$ref": "#/$defs/DisadvantageEffect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Grants disadvantage"
        },
        "roll_modifier": {
          "anyOf": [
            {
              "$ref": "#/$defs/RollModifier"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Modifies dice rolls"
        },
        "damage": {
          "anyOf": [
            {
              "$ref": "#/$defs/Damage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Damage dealt by this effect"
        },
        "damage_bonus": {
          "anyOf": [
            {
              "$ref": "#/$defs/Damage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Bonus damage applied"
        },
        "saving_throw": {
          "anyOf": [
            {
              "$ref": "#/$defs/SavingThrow"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Saving throw required by this effect"
        },
        "trigger": {
          "anyOf": [
            {
              "$ref": "#/$defs/Trigger"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Event that triggers this effect"
        },
        "duration": {
          "anyOf": [
            {
              "$ref": "#/$defs/Duration"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How long this effect lasts"
        },
        "lighting": {
          "anyOf": [
            {
              "$ref": "#/$defs/Lighting"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Light emanation independent of an environment (e.g., Faerie Fire dim light)"
        },
        "negate": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions or statuses negated by this effect (e.g., ['invisible'])",
          "title": "Negate"
        },
        "recurring_damage": {
          "anyOf": [
            {
              "$ref": "#/$defs/Damage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Damage that recurs while a status is active (e.g., Searing Smite fire damage)"
        },
        "grants": {
          "anyOf": [
            {
              "$ref": "#/$defs/Grant"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Action or ability granted"
        },
        "environment": {
          "anyOf": [
            {
              "$ref": "#/$defs/Environment"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Environmental effect (lighting, terrain, hazard, etc.)"
        },
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Effect type for typed effects",
          "title": "Type"
        },
        "attribute": {
          "anyOf": [
            {
              "$ref": "#/$defs/AttributeModification"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Attribute modification"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement",
                    "attribute": "#/$defs/AttributeRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttributeRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Requirements for this effect",
          "title": "Requirements"
        },
        "scaling_key": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Reference to scaling property",
          "title": "Scaling Key"
        },
        "effects": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/Effect"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Nested effects",
          "title": "Effects"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/Target"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Who or what this effect targets"
        },
        "area": {
          "anyOf": [
            {
              "$ref": "#/$defs/Area"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Area of effect"
        },
        "range": {
          "anyOf": [
            {
              "$ref": "#/$defs/Distance"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Range of the effect"
        },
        "blocked_by": {
          "anyOf": [
            {
              "$ref": "#/$defs/BlockedBy"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Cover or barriers that prevent this effect from reaching targets"
        },
        "attack": {
          "anyOf": [
            {
              "$ref": "#/$defs/Attack"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Attack roll for this effect"
        },
        "roll": {
          "anyOf": [
            {
              "$ref": "#/$defs/Roll"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dice roll with optional success condition"
        },
        "on_failure": {
          "anyOf": [
            {
              "$ref": "#/$defs/Effect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What happens on a failed save"
        },
        "on_success": {
          "anyOf": [
            {
              "$ref": "#/$defs/Effect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What happens on a successful save"
        },
        "on_hit": {
          "anyOf": [
            {
              "$ref": "#/$defs/Effect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What happens when an attack hits"
        },
        "count": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Number of times or targets",
          "title": "Count"
        },
        "ends_spell": {
          "default": false,
          "description": "Whether this effect terminates the spell when it fires",
          "title": "Ends Spell",
          "type": "boolean"
        },
        "calculation": {
          "anyOf": [
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Math operation (add, max, etc.) with operators"
        },
        "entity": {
          "anyOf": [
            {
              "$ref": "#/$defs/Entity"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity created or summoned by this effect"
        },
        "movement": {
          "anyOf": [
            {
              "$ref": "#/$defs/Movement"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Movement operation (pass_through, reposition, etc.)"
        },
        "forced_movement": {
          "anyOf": [
            {
              "$ref": "#/$defs/ForcedMovement"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Involuntary displacement (push, pull, lift)"
        },
        "detection": {
          "anyOf": [
            {
              "$ref": "#/$defs/Detection"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Sensory detection effect (range, detects, blocked_by)"
        },
        "aura": {
          "anyOf": [
            {
              "$ref": "#/$defs/Aura"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Aura emanated by this effect"
        },
        "apply_status": {
          "anyOf": [
            {
              "$ref": "#/$defs/ApplyStatus"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Status condition to apply"
        },
        "healing": {
          "anyOf": [
            {
              "$ref": "#/$defs/Healing"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Healing effect"
        },
        "choice": {
          "anyOf": [
            {
              "$ref": "#/$defs/Choice"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Player choice within this effect"
        },
        "manipulate": {
          "anyOf": [
            {
              "$ref": "#/$defs/Manipulate"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Manipulation of an environment property (lighting, terrain) on a target"
        },
        "recover": {
          "anyOf": [
            {
              "$ref": "#/$defs/Recover"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Resource recovery operation (restore uses to a resource pool or spell slot)"
        },
        "damage_response": {
          "anyOf": [
            {
              "$ref": "#/$defs/DamageResponse"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Damage response modifier (resistance, immunity, or vulnerability)"
        },
        "immunity": {
          "anyOf": [
            {
              "discriminator": {
                "mapping": {
                  "advantage": "#/$defs/AdvantageImmunity",
                  "disadvantage": "#/$defs/DisadvantageImmunity",
                  "effect": "#/$defs/EffectImmunity",
                  "spell": "#/$defs/SpellImmunity",
                  "status": "#/$defs/StatusImmunity",
                  "trigger": "#/$defs/TriggerImmunity"
                },
                "propertyName": "category"
              },
              "oneOf": [
                {
                  "$ref": "#/$defs/StatusImmunity"
                },
                {
                  "$ref": "#/$defs/SpellImmunity"
                },
                {
                  "$ref": "#/$defs/EffectImmunity"
                },
                {
                  "$ref": "#/$defs/TriggerImmunity"
                },
                {
                  "$ref": "#/$defs/AdvantageImmunity"
                },
                {
                  "$ref": "#/$defs/DisadvantageImmunity"
                }
              ]
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Immunity granted by this effect",
          "title": "Immunity"
        },
        "additional_damage": {
          "anyOf": [
            {
              "$ref": "#/$defs/Damage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Supplementary damage alongside primary (e.g., Booming Blade thunder damage)"
        },
        "replaces": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Status name this effect replaces (e.g., Destroy Undead replaces 'turned' with 'dead')",
          "title": "Replaces"
        },
        "recharge": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "$ref": "#/$defs/Duration"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Recharge timing on save result (e.g., 'long_rest' or {value: 7, unit: 'days'})",
          "title": "Recharge"
        },
        "player_choice": {
          "default": false,
          "description": "Whether the player chooses how to distribute this effect",
          "title": "Player Choice",
          "type": "boolean"
        },
        "chain": {
          "anyOf": [
            {
              "$ref": "#/$defs/Chain"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Chaining behavior to jump to additional targets (e.g., Chaos Bolt)"
        },
        "distribution": {
          "anyOf": [
            {
              "$ref": "#/$defs/Distribution"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Rolled budget distributed across targets (e.g., Color Spray, Sleep)"
        },
        "projectile": {
          "anyOf": [
            {
              "$ref": "#/$defs/Projectile"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Projectile-based effect with multiple independent hits (e.g., Magic Missile)"
        },
        "sustained": {
          "anyOf": [
            {
              "$ref": "#/$defs/Sustained"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Sustained effect repeatable on subsequent turns (e.g., Witch Bolt)"
        },
        "ignore_requirement": {
          "anyOf": [
            {
              "$ref": "#/$defs/IgnoreRequirement"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Requirement that this effect allows bypassing"
        }
      },
      "title": "Effect",
      "type": "object"
    },
    "EffectImmunity": {
      "description": "Immunity to a game effect (e.g., disarm).",
      "properties": {
        "category": {
          "const": "effect",
          "default": "effect",
          "title": "Category",
          "type": "string"
        },
        "effect": {
          "description": "Effect name immune to (e.g., 'disarm')",
          "title": "Effect",
          "type": "string"
        }
      },
      "required": ["effect"],
      "title": "EffectImmunity",
      "type": "object"
    },
    "EffectTargetRequirement": {
      "description": "Requirement based on who the effect targets (self vs others).",
      "properties": {
        "type": {
          "const": "effect_target",
          "default": "effect_target",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Target constraint",
          "enum": ["not_self", "self", "ally", "enemy", "creature"],
          "title": "Value",
          "type": "string"
        }
      },
      "required": ["value"],
      "title": "EffectTargetRequirement",
      "type": "object"
    },
    "Entity": {
      "description": "A discrete thing created or summoned by a spell or ability.\n\nCovers lights (Dancing Lights), illusions (Minor Illusion, Silent Image),\nobjects (Goodberry, bonded weapons), and conjurations (Mage Hand, Invoke Duplicity).",
      "properties": {
        "category": {
          "description": "What kind of entity (e.g., 'light', 'illusion', 'object', 'conjuration')",
          "title": "Category",
          "type": "string"
        },
        "type": {
          "description": "Specific entity type (e.g., 'flame', 'spectral_hand', 'duplicate')",
          "title": "Type",
          "type": "string"
        },
        "name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Display name for inventory or tracking (e.g., 'goodberry')",
          "title": "Name"
        },
        "count": {
          "default": 1,
          "description": "Number of entities created",
          "title": "Count",
          "type": "integer"
        },
        "placement": {
          "anyOf": [
            {
              "$ref": "#/$defs/Placement"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Where the entity appears when created or summoned"
        },
        "speed": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Movement speed in feet per action",
          "title": "Speed"
        },
        "carrying_capacity": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum weight in pounds the entity can carry",
          "title": "Carrying Capacity"
        },
        "allowed_actions": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whitelist of actions the entity can perform (e.g., 'manipulate', 'object_interaction')",
          "title": "Allowed Actions"
        },
        "interactions": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/EntityInteraction"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How others can interact with or counter this entity",
          "title": "Interactions"
        },
        "capabilities": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Capabilities granted to or by the entity (e.g., 'spell_origin_point')",
          "title": "Capabilities"
        },
        "tether": {
          "anyOf": [
            {
              "$ref": "#/$defs/Distance"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum distance from caster before entity is dismissed"
        }
      },
      "required": ["category", "type"],
      "title": "Entity",
      "type": "object"
    },
    "EntityInteraction": {
      "description": "How other creatures can interact with or counter this entity.",
      "properties": {
        "action": {
          "description": "Action required to interact (e.g., 'examine')",
          "title": "Action",
          "type": "string"
        },
        "check": {
          "anyOf": [
            {
              "$ref": "#/$defs/SkillCheck"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Skill check to resolve the interaction"
        }
      },
      "required": ["action"],
      "title": "Interaction",
      "type": "object"
    },
    "Environment": {
      "description": "Environmental effect that modifies an area of the battlefield.\n\nDescribes static properties: area shape, terrain, visibility, lighting, surface.\nDynamic effects (damage on enter, saves) use Effect-level trigger/saving_throw/on_failure.\n\nExamples:\n- Create Bonfire: environment (area + lighting) + Effect (trigger + save + damage)\n- Fog Cloud: environment (area + visibility)\n- Grease: environment (area + surface) + Effect (trigger + save + prone)\n- Spike Growth: environment (area + terrain) + Effect (trigger + damage)\n- Darkness: environment (area + lighting + visibility)",
      "properties": {
        "area": {
          "$ref": "#/$defs/Area",
          "description": "Shape and size of the affected area"
        },
        "lighting": {
          "anyOf": [
            {
              "$ref": "#/$defs/Lighting"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Light level changes"
        },
        "terrain": {
          "anyOf": [
            {
              "$ref": "#/$defs/Terrain"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Movement/terrain effects"
        },
        "visibility": {
          "anyOf": [
            {
              "$ref": "#/$defs/Visibility"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Vision obstruction"
        },
        "surface": {
          "anyOf": [
            {
              "$ref": "#/$defs/Surface"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Surface type"
        }
      },
      "required": ["area"],
      "title": "Environment",
      "type": "object"
    },
    "EnvironmentRequirement": {
      "description": "Requirement based on environmental conditions.",
      "properties": {
        "type": {
          "const": "environment",
          "default": "environment",
          "title": "Type",
          "type": "string"
        },
        "lighting": {
          "anyOf": [
            {
              "enum": ["bright_light", "dim_light", "darkness", "magical_darkness"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Lighting condition",
          "title": "Lighting"
        },
        "terrain": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Terrain type",
          "title": "Terrain"
        }
      },
      "title": "EnvironmentRequirement",
      "type": "object"
    },
    "EquipmentRequirement": {
      "description": "Equipment-based requirement for slot occupancy, grip, or item presence.",
      "properties": {
        "type": {
          "const": "equipment",
          "default": "equipment",
          "title": "Type",
          "type": "string"
        },
        "slot": {
          "anyOf": [
            {
              "enum": ["armor", "main_hand", "off_hand"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Equipment slot to check",
          "title": "Slot"
        },
        "occupied": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether slot should be filled (true) or empty (false)",
          "title": "Occupied"
        },
        "grip": {
          "anyOf": [
            {
              "enum": ["one-handed", "two-handed"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How the weapon is being held (main_hand slot only)",
          "title": "Grip"
        },
        "item": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Specific item that must be equipped (for accessories)",
          "title": "Item"
        },
        "function": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Function reference for complex checks (e.g., 'equipment.is_wearing_heavy_armor')",
          "title": "Function"
        },
        "negate": {
          "default": false,
          "description": "Invert the check result",
          "title": "Negate",
          "type": "boolean"
        }
      },
      "title": "EquipmentRequirement",
      "type": "object"
    },
    "ForcedMovement": {
      "description": "Immediate involuntary displacement of a target.\n\nExample \u2014 Thunderwave pushes target 10 feet away:\n{\n    \"direction\": \"away\",\n    \"relative_to\": \"character\",\n    \"distance\": 10\n}\n\nExample \u2014 Dissonant Whispers (costs target's reaction, avoids hazards):\n{\n    \"direction\": \"away\",\n    \"relative_to\": \"character\",\n    \"cost\": \"reaction\",\n    \"avoid_hazards\": true\n}\n\nExample \u2014 Snare lifts target 3 feet up:\n{\n    \"direction\": \"up\",\n    \"distance\": 3\n}",
      "properties": {
        "direction": {
          "description": "Direction of displacement",
          "enum": ["away", "toward", "up", "down", "random"],
          "title": "Direction",
          "type": "string"
        },
        "relative_to": {
          "anyOf": [
            {
              "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Reference entity for relative directions (away, toward)",
          "title": "Relative To"
        },
        "distance": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "#/$defs/Distance"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Distance in feet (int) or structured Distance",
          "title": "Distance"
        },
        "type": {
          "anyOf": [
            {
              "const": "push",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Movement subtype",
          "title": "Type"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions for this movement to apply (e.g., size limits)",
          "title": "Requirements"
        },
        "cost": {
          "anyOf": [
            {
              "$ref": "#/$defs/ActivationType"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Turn phase consumed to execute this movement (e.g., reaction)"
        },
        "avoid_hazards": {
          "default": false,
          "description": "Target avoids obviously harmful terrain while moving",
          "title": "Avoid Hazards",
          "type": "boolean"
        }
      },
      "required": ["direction"],
      "title": "ForcedMovement",
      "type": "object"
    },
    "FunctionOperand": {
      "description": "A function call that returns a value.",
      "properties": {
        "type": {
          "const": "function",
          "default": "function",
          "title": "Type",
          "type": "string"
        },
        "function": {
          "description": "Function name",
          "title": "Function",
          "type": "string"
        },
        "context": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Context parameter (e.g., 'character')",
          "title": "Context"
        },
        "transform": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Transform to apply to result",
          "title": "Transform"
        }
      },
      "required": ["function"],
      "title": "FunctionOperand",
      "type": "object"
    },
    "FunctionReference": {
      "description": "A reference to a domain function that resolves to a value at runtime.",
      "properties": {
        "function": {
          "description": "Function path (e.g., 'spellcasting.max_spell_level')",
          "title": "Function",
          "type": "string"
        },
        "context": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Context entity (e.g., 'character')",
          "title": "Context"
        },
        "class": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Class name for class-scoped functions",
          "title": "Class"
        }
      },
      "required": ["function"],
      "title": "FunctionReference",
      "type": "object"
    },
    "FunctionRequirement": {
      "description": "Requirement based on a domain/logic function that returns a boolean.",
      "properties": {
        "type": {
          "const": "function",
          "default": "function",
          "title": "Type",
          "type": "string"
        },
        "function": {
          "description": "Function path in domain/logic (e.g., 'resources.check_pool_remaining')",
          "title": "Function",
          "type": "string"
        },
        "context": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Context entity (e.g., 'character', 'target')",
          "title": "Context"
        },
        "params": {
          "anyOf": [
            {
              "additionalProperties": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "integer"
                  }
                ]
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Parameters passed to the function",
          "title": "Params"
        }
      },
      "required": ["function"],
      "title": "FunctionRequirement",
      "type": "object"
    },
    "Grant": {
      "description": "Defines what action or ability is granted by a mechanic or effect.",
      "properties": {
        "name": {
          "description": "Name of the granted action (e.g., 'Attack', 'Dash', 'Move')",
          "title": "Name",
          "type": "string"
        },
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Type qualifier (e.g., 'melee', 'ranged', 'weapon') for attacks",
          "title": "Type"
        },
        "activation": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How the granted action is activated (e.g., 'reaction', 'bonus_action')",
          "title": "Activation"
        },
        "action": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Action type granted (e.g., 'weapon_attack')",
          "title": "Action"
        },
        "count": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Number of times the action can be taken",
          "title": "Count"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/Target"
            },
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target of the granted action",
          "title": "Target"
        },
        "distance": {
          "anyOf": [
            {
              "$ref": "#/$defs/Distance"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Distance specification for movement grants"
        },
        "immunity": {
          "anyOf": [
            {
              "discriminator": {
                "mapping": {
                  "advantage": "#/$defs/AdvantageImmunity",
                  "disadvantage": "#/$defs/DisadvantageImmunity",
                  "effect": "#/$defs/EffectImmunity",
                  "spell": "#/$defs/SpellImmunity",
                  "status": "#/$defs/StatusImmunity",
                  "trigger": "#/$defs/TriggerImmunity"
                },
                "propertyName": "category"
              },
              "oneOf": [
                {
                  "$ref": "#/$defs/StatusImmunity"
                },
                {
                  "$ref": "#/$defs/SpellImmunity"
                },
                {
                  "$ref": "#/$defs/EffectImmunity"
                },
                {
                  "$ref": "#/$defs/TriggerImmunity"
                },
                {
                  "$ref": "#/$defs/AdvantageImmunity"
                },
                {
                  "$ref": "#/$defs/DisadvantageImmunity"
                }
              ]
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Immunity granted during the action (e.g., immunity to opportunity_attack trigger)",
          "title": "Immunity"
        },
        "interaction": {
          "anyOf": [
            {
              "$ref": "#/$defs/GrantInteraction"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Modified activation of a spell or feature granted by this ability"
        }
      },
      "required": ["name"],
      "title": "Grant",
      "type": "object"
    },
    "GrantInteraction": {
      "description": "Describes activating a spell or feature with modifications or side effects.\n\nCovers cross-ability interactions: one ability granting a modified\nactivation of another spell or feature.\n\nExample \u2014 Read Thoughts \u2192 Suggestion (spell, no slot, auto-fail save):\n{\"name\": \"Suggestion\", \"activation\": \"action\", \"cost\": \"none\",\n \"save\": \"auto_fail\", \"ends\": [\"read_surface_thoughts\"]}\n\nExample \u2014 Feral Instinct \u2192 Rage (feature, must be first action):\n{\"name\": \"Rage\", \"activation\": \"bonus_action\", \"order\": \"first\"}\n\nExample \u2014 Use Magic Device (bypass item requirements):\n{\"ignore_requirements\": [\"class\", \"race\", \"level\"]}",
      "properties": {
        "name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Name of the spell or feature to activate",
          "title": "Name"
        },
        "activation": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Action cost (e.g., 'action', 'bonus_action')",
          "title": "Activation"
        },
        "order": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Sequencing constraint (e.g., 'first' \u2014 must be first action on turn)",
          "title": "Order"
        },
        "cost": {
          "anyOf": [
            {
              "const": "none",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Override the normal resource cost",
          "title": "Cost"
        },
        "save": {
          "anyOf": [
            {
              "enum": ["auto_fail", "auto_succeed"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Override the saving throw behavior",
          "title": "Save"
        },
        "ends": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Effect identifiers terminated when this interaction fires",
          "title": "Ends"
        },
        "ignore_requirements": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Requirement categories bypassed (e.g., ['class', 'race', 'level'])",
          "title": "Ignore Requirements"
        }
      },
      "title": "Interaction",
      "type": "object"
    },
    "GrantedSpellsMechanic": {
      "description": "Grants spells from class features, domains, or race traits.",
      "properties": {
        "type": {
          "const": "granted_spells",
          "description": "Must be 'granted_spells'",
          "title": "Type",
          "type": "string"
        },
        "spells": {
          "anyOf": [
            {
              "additionalProperties": {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              "type": "object"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "description": "Spell level map (e.g., {'1': ['Bless']}) or flat list of spell names",
          "title": "Spells"
        },
        "always_prepared": {
          "default": false,
          "description": "Whether these spells are always prepared (don't count against limit)",
          "title": "Always Prepared",
          "type": "boolean"
        },
        "does_not_count_against_limit": {
          "default": false,
          "description": "Whether these spells don't count against cantrips/spells known limit",
          "title": "Does Not Count Against Limit",
          "type": "boolean"
        },
        "ritual_only": {
          "default": false,
          "description": "Whether these spells can only be cast as rituals",
          "title": "Ritual Only",
          "type": "boolean"
        }
      },
      "required": ["type", "spells"],
      "title": "GrantedSpellsMechanic",
      "type": "object"
    },
    "Healing": {
      "description": "Healing specification \u2014 dice, flat value, or calculation.",
      "properties": {
        "dice": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dice expression (e.g., '1d8', '1d4')",
          "title": "Dice"
        },
        "bonus": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Flat numeric bonus or calculated bonus (e.g., ability modifier)",
          "title": "Bonus"
        },
        "value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Simple flat healing value (e.g., 1 for Goodberry)",
          "title": "Value"
        },
        "calculation": {
          "anyOf": [
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Complex healing calculation (e.g., 5 \u00d7 cleric level)"
        },
        "barrier": {
          "default": false,
          "description": "Grants temporary HP instead of actual healing",
          "title": "Barrier",
          "type": "boolean"
        },
        "distribution": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How healing is distributed (e.g., 'player_allocation')",
          "title": "Distribution"
        }
      },
      "title": "Healing",
      "type": "object"
    },
    "HitPointsRequirement": {
      "description": "Requirement based on hit points.",
      "properties": {
        "type": {
          "const": "hit_points",
          "default": "hit_points",
          "title": "Type",
          "type": "string"
        },
        "attribute": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "HP attribute to check",
          "title": "Attribute"
        },
        "comparison": {
          "anyOf": [
            {
              "enum": ["equals", "greater_than", "less_than", "at_most", "at_least"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Comparison operator",
          "title": "Comparison"
        },
        "value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Static value to compare against",
          "title": "Value"
        },
        "calculation": {
          "anyOf": [
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Calculated value to compare against"
        }
      },
      "title": "HitPointsRequirement",
      "type": "object"
    },
    "IgnoreRequirement": {
      "description": "Specifies a requirement type that this effect allows bypassing.",
      "properties": {
        "type": {
          "description": "The type of requirement to ignore (e.g., 'attribute')",
          "title": "Type",
          "type": "string"
        },
        "attribute": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Specific attribute to ignore requirement for (e.g., 'Strength')",
          "title": "Attribute"
        },
        "source": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Source of the requirement to ignore (e.g., 'armor')",
          "title": "Source"
        }
      },
      "required": ["type"],
      "title": "IgnoreRequirement",
      "type": "object"
    },
    "ImmunityRequirement": {
      "description": "Requirement based on immunity to a status/damage type.",
      "properties": {
        "type": {
          "const": "immunity",
          "default": "immunity",
          "title": "Type",
          "type": "string"
        },
        "to": {
          "description": "Status or damage type that immunity is checked for",
          "title": "To",
          "type": "string"
        },
        "negate": {
          "default": false,
          "description": "If true, target must NOT be immune",
          "title": "Negate",
          "type": "boolean"
        }
      },
      "required": ["to"],
      "title": "ImmunityRequirement",
      "type": "object"
    },
    "ImmunitySource": {
      "description": "Source constraint for an immunity (e.g., magical origin).",
      "properties": {
        "origin": {
          "description": "Origin type of the effect (e.g., 'magical')",
          "title": "Origin",
          "type": "string"
        }
      },
      "required": ["origin"],
      "title": "ImmunitySource",
      "type": "object"
    },
    "IntegerOperand": {
      "description": "A static integer value.",
      "properties": {
        "type": {
          "const": "integer",
          "default": "integer",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Integer value",
          "title": "Value",
          "type": "integer"
        }
      },
      "required": ["value"],
      "title": "IntegerOperand",
      "type": "object"
    },
    "InventoryItemRequirement": {
      "description": "Requirement for having a specific item in inventory.",
      "properties": {
        "type": {
          "const": "inventory_item",
          "default": "inventory_item",
          "title": "Type",
          "type": "string"
        },
        "name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Exact item name required",
          "title": "Name"
        },
        "name_contains": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Item name must contain one of these strings",
          "title": "Name Contains"
        }
      },
      "title": "InventoryItemRequirement",
      "type": "object"
    },
    "LevelRequirement": {
      "description": "Requirement based on character level.",
      "properties": {
        "type": {
          "const": "level",
          "default": "level",
          "title": "Type",
          "type": "string"
        },
        "minimum": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Minimum character level",
          "title": "Minimum"
        },
        "maximum": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum character level",
          "title": "Maximum"
        }
      },
      "title": "LevelRequirement",
      "type": "object"
    },
    "Lighting": {
      "description": "Light level produced or modified by the environment.\n\nExamples:\n- Create Bonfire: produces bright/dim light\n- Darkness: creates magical darkness\n- Dancing Lights: produces dim light with color choice",
      "properties": {
        "level": {
          "description": "Light level in the area",
          "enum": ["bright", "dim", "darkness", "magical_darkness"],
          "title": "Level",
          "type": "string"
        },
        "color": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Color of the light ('choice' for caster-chosen, or specific like 'fire', 'blue')",
          "title": "Color"
        },
        "radius": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Radius of light effect if different from area size (for layered light)",
          "title": "Radius"
        },
        "dim_radius": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Extended dim light radius beyond the bright light",
          "title": "Dim Radius"
        }
      },
      "required": ["level"],
      "title": "Lighting",
      "type": "object"
    },
    "LocationVisibility": {
      "description": "Visibility requirement for locations (placement, movement destinations).\n\nUsed for effects like teleportation or summoning where the character\nmust be able to see the destination.",
      "properties": {
        "requires": {
          "default": "line_of_sight",
          "description": "Type of visibility required",
          "enum": ["line_of_sight", "unobstructed"],
          "title": "Requires",
          "type": "string"
        },
        "from_entity": {
          "default": "character",
          "description": "Entity that must have visibility",
          "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
          "title": "From Entity",
          "type": "string"
        }
      },
      "title": "LocationVisibility",
      "type": "object"
    },
    "Manipulate": {
      "description": "Manipulation of an environment property on a targeted object.\n\nThe target (which campfire, which section of earth) is identified by the\nparent Effect's target field. The engine resolves the specific instance.\n\nExample \u2014 Druidcraft light a candle:\n{\"model\": \"lighting\", \"operation\": \"create\"}\n\nExample \u2014 Control Flames extinguish:\n{\"model\": \"lighting\", \"operation\": \"remove\"}\n\nExample \u2014 Mold Earth difficult terrain toggle:\n{\"model\": \"terrain\", \"operation\": \"toggle\"}\n\nExample \u2014 Control Flames change light (with calculation on parent Effect):\n{\"model\": \"lighting\", \"operation\": \"modify\"}",
      "properties": {
        "model": {
          "description": "Environment model being manipulated",
          "enum": ["lighting", "terrain"],
          "title": "Model",
          "type": "string"
        },
        "operation": {
          "description": "Operation to perform on the target instance",
          "enum": ["create", "remove", "modify", "toggle"],
          "title": "Operation",
          "type": "string"
        }
      },
      "required": ["model", "operation"],
      "title": "Manipulate",
      "type": "object"
    },
    "NestedChoice": {
      "description": "A nested choice specification used within ChoiceOption for either/or selections like ASI.",
      "properties": {
        "choice_type": {
          "$ref": "#/$defs/ChoiceType",
          "description": "Type of choice (ability_score, feat, skill, etc.)"
        },
        "count": {
          "default": 1,
          "description": "How many to select",
          "title": "Count",
          "type": "integer"
        },
        "value": {
          "anyOf": [
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Value calculation to apply (e.g., +1 for ability score increases using add operation)",
          "title": "Value"
        },
        "unique": {
          "default": false,
          "description": "Whether selections must be unique (no duplicates allowed)",
          "title": "Unique",
          "type": "boolean"
        },
        "options": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Explicit list of options if not implied by choice_type",
          "title": "Options"
        }
      },
      "required": ["choice_type"],
      "title": "NestedChoice",
      "type": "object"
    },
    "Movement": {
      "description": "Movement operation \u2014 repositioning entities, teleporting, or passing through.",
      "properties": {
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Movement mode (teleport, pass_through)",
          "title": "Type"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/Target"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What is being moved"
        },
        "distance": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How far to move in feet",
          "title": "Distance"
        },
        "destination": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Named destination (e.g., 'hand')",
          "title": "Destination"
        },
        "space": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Space constraint for destination (e.g., 'unoccupied')",
          "title": "Space"
        },
        "visibility": {
          "anyOf": [
            {
              "$ref": "#/$defs/LocationVisibility"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Visibility requirement for destination"
        },
        "timing": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "When movement can occur relative to the triggering action (e.g., ['before', 'after'])",
          "title": "Timing"
        }
      },
      "title": "Movement",
      "type": "object"
    },
    "MovementConstraint": {
      "description": "Movement restriction applied on the target's turn.\n\nExample \u2014 Turn Undead forces fleeing:\n{\"direction\": \"away\", \"relative_to\": \"character\", \"keep_distance\": 30}\n\nExample \u2014 Frightened can't approach source:\n{\"direction\": \"away\", \"relative_to\": \"source\"}",
      "properties": {
        "direction": {
          "anyOf": [
            {
              "enum": ["away", "toward"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Direction the target must move on its turn",
          "title": "Direction"
        },
        "relative_to": {
          "anyOf": [
            {
              "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity the direction is relative to",
          "title": "Relative To"
        },
        "keep_distance": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Distance in feet the target must maintain from relative_to",
          "title": "Keep Distance"
        }
      },
      "title": "MovementConstraint",
      "type": "object"
    },
    "Origin": {
      "description": "Origin of an effect - magical or nonmagical.",
      "enum": ["magical", "nonmagical"],
      "title": "Origin",
      "type": "string"
    },
    "Perception": {
      "description": "Explicit perception requirement between two entities.\n\nSpecifies that an observer must be able to perceive a subject\nusing one or more senses.\n\nExamples:\n    Target must hear character (Bardic Inspiration):\n    {\"observer\": \"target\", \"subject\": \"character\", \"senses\": [\"hearing\"]}\n\n    Character must see attacker (Warding Flare):\n    {\"observer\": \"character\", \"subject\": \"attacker\", \"senses\": [\"sight\"]}\n\n    Target must see OR hear character (Turn Undead):\n    {\"observer\": \"target\", \"subject\": \"character\", \"senses\": [\"sight\", \"hearing\"], \"match\": \"any\"}\n\n    Target must NOT see character (Magical Ambush - hidden):\n    {\"observer\": \"target\", \"subject\": \"character\", \"senses\": [\"sight\"], \"negate\": true}",
      "properties": {
        "observer": {
          "description": "Entity that must do the perceiving",
          "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
          "title": "Observer",
          "type": "string"
        },
        "subject": {
          "description": "Entity that must be perceived",
          "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
          "title": "Subject",
          "type": "string"
        },
        "senses": {
          "description": "Required sense(s) - sight, hearing",
          "items": {
            "enum": ["sight", "hearing"],
            "type": "string"
          },
          "title": "Senses",
          "type": "array"
        },
        "match": {
          "default": "all",
          "description": "For multiple senses: 'any' = at least one, 'all' = all required",
          "enum": ["any", "all"],
          "title": "Match",
          "type": "string"
        },
        "negate": {
          "default": false,
          "description": "If true, observer must NOT perceive subject",
          "title": "Negate",
          "type": "boolean"
        }
      },
      "required": ["observer", "subject", "senses"],
      "title": "Perception",
      "type": "object"
    },
    "PerceptionRequirement": {
      "description": "Perception-based requirement for sight/hearing checks.",
      "properties": {
        "type": {
          "const": "perception",
          "default": "perception",
          "title": "Type",
          "type": "string"
        },
        "observer": {
          "description": "Entity that must perceive",
          "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
          "title": "Observer",
          "type": "string"
        },
        "subject": {
          "description": "Entity that must be perceived",
          "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
          "title": "Subject",
          "type": "string"
        },
        "senses": {
          "description": "Required senses: sight, hearing",
          "items": {
            "enum": ["sight", "hearing"],
            "type": "string"
          },
          "title": "Senses",
          "type": "array"
        },
        "match": {
          "default": "all",
          "description": "Whether any or all senses required",
          "enum": ["any", "all"],
          "title": "Match",
          "type": "string"
        },
        "negate": {
          "default": false,
          "description": "If true, observer must NOT perceive subject",
          "title": "Negate",
          "type": "boolean"
        }
      },
      "required": ["observer", "subject", "senses"],
      "title": "PerceptionRequirement",
      "type": "object"
    },
    "Placement": {
      "description": "Where an entity appears when created or summoned.",
      "properties": {
        "range": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum distance from caster in feet",
          "title": "Range"
        },
        "space": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Space constraint (e.g., 'unoccupied')",
          "title": "Space"
        },
        "visibility": {
          "anyOf": [
            {
              "$ref": "#/$defs/LocationVisibility"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Visibility requirement for the placement location"
        },
        "forms": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Available visual forms to choose from when placing (e.g., 'torch', 'orb')",
          "title": "Forms"
        },
        "separation": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum distance in feet between instances when count > 1",
          "title": "Separation"
        }
      },
      "title": "Placement",
      "type": "object"
    },
    "ProficiencyMechanic": {
      "description": "Grants proficiency in skills, weapons, armor, saving throws, or tools.",
      "properties": {
        "type": {
          "const": "proficiency",
          "description": "Must be 'proficiency'",
          "title": "Type",
          "type": "string"
        },
        "category": {
          "description": "What kind of proficiency (skill, weapon, armor, saving_throw, tool)",
          "enum": ["skill", "weapon", "armor", "saving_throw", "tool"],
          "title": "Category",
          "type": "string"
        },
        "proficiencies": {
          "description": "List of proficiency names granted",
          "items": {
            "type": "string"
          },
          "title": "Proficiencies",
          "type": "array"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Requirements that must be met",
          "title": "Requirements"
        }
      },
      "required": ["type", "category", "proficiencies"],
      "title": "ProficiencyMechanic",
      "type": "object"
    },
    "Projectile": {
      "description": "Projectile-based effect with multiple independent hits.\n\nExample \u2014 Magic Missile:\n{\"count\": 3, \"auto_hit\": true, \"damage\": {\"dice\": \"1d4\", \"bonus\": 1, \"type\": [\"force\"]}}",
      "properties": {
        "count": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "string"
            }
          ],
          "description": "Number of projectiles (int or scaling reference)",
          "title": "Count"
        },
        "auto_hit": {
          "default": false,
          "description": "Projectiles bypass attack rolls",
          "title": "Auto Hit",
          "type": "boolean"
        },
        "damage": {
          "$ref": "#/$defs/Damage",
          "description": "Damage per projectile"
        }
      },
      "required": ["count", "damage"],
      "title": "Projectile",
      "type": "object"
    },
    "ProximityRequirement": {
      "description": "Requirement based on proximity between entities.",
      "properties": {
        "type": {
          "const": "proximity",
          "default": "proximity",
          "title": "Type",
          "type": "string"
        },
        "entities": {
          "description": "Entities to check proximity from (e.g., 'self', 'mage_hand', 'illusion')",
          "items": {
            "type": "string"
          },
          "title": "Entities",
          "type": "array"
        },
        "distance": {
          "description": "Distance in feet",
          "title": "Distance",
          "type": "integer"
        },
        "to": {
          "description": "Reference point to measure distance to (e.g., 'target')",
          "title": "To",
          "type": "string"
        }
      },
      "required": ["entities", "distance", "to"],
      "title": "ProximityRequirement",
      "type": "object"
    },
    "Query": {
      "description": "Data query against a game data endpoint.\n\nMirrors an endpoint definition:\n- endpoint: the route to query\n- params: simple key-value query parameters, ready to use\n- resolve: values that need function computation before becoming params",
      "properties": {
        "endpoint": {
          "description": "API endpoint to query (e.g., 'equipment', 'spells', 'maneuvers')",
          "title": "Endpoint",
          "type": "string"
        },
        "params": {
          "anyOf": [
            {
              "additionalProperties": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "integer"
                  }
                ]
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Simple query parameters passed to the endpoint",
          "title": "Params"
        },
        "resolve": {
          "anyOf": [
            {
              "additionalProperties": {
                "$ref": "#/$defs/FunctionReference"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Parameters that require function resolution before querying",
          "title": "Resolve"
        }
      },
      "required": ["endpoint"],
      "title": "Query",
      "type": "object"
    },
    "RechargeType": {
      "enum": ["short_rest", "long_rest", "turn", "round", "dawn", "special"],
      "title": "RechargeType",
      "type": "string"
    },
    "Recover": {
      "description": "Resource recovery operation (restore spell slots, etc.).",
      "properties": {
        "target": {
          "description": "Resource to recover (e.g., 'spell_slot')",
          "title": "Target",
          "type": "string"
        },
        "count": {
          "description": "Number of resources to recover",
          "title": "Count",
          "type": "integer"
        },
        "max_level": {
          "anyOf": [
            {
              "$ref": "#/$defs/RecoverMaxLevel"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Level constraint on recovered resource"
        }
      },
      "required": ["target", "count"],
      "title": "Recover",
      "type": "object"
    },
    "RecoverMaxLevel": {
      "description": "Constraint on maximum level of recovered resource.",
      "properties": {
        "calculation": {
          "description": "Function to calculate max level",
          "title": "Calculation",
          "type": "string"
        },
        "operation": {
          "description": "Operation to apply to result",
          "title": "Operation",
          "type": "string"
        },
        "divisor": {
          "description": "Divisor for the operation",
          "title": "Divisor",
          "type": "integer"
        },
        "rounding": {
          "description": "Rounding direction",
          "enum": ["up", "down"],
          "title": "Rounding",
          "type": "string"
        }
      },
      "required": ["calculation", "operation", "divisor", "rounding"],
      "title": "RecoverMaxLevel",
      "type": "object"
    },
    "Reroll": {
      "description": "Reroll condition \u2014 which die results trigger a reroll.\n\nExample \u2014 Great Weapon Fighting:\n{\"on\": [1, 2], \"replace\": true}\n\nExample \u2014 Stroke of Luck (ability check, fixed value):\n{\"value\": 20}\n\nExample \u2014 Paralyzed (attacker within 5ft, force critical):\n{\"value\": 20}",
      "properties": {
        "on": {
          "anyOf": [
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Die results that trigger a reroll (e.g., [1, 2])",
          "title": "On"
        },
        "replace": {
          "default": false,
          "description": "Must use the new roll even if lower",
          "title": "Replace",
          "type": "boolean"
        },
        "result": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Force the outcome \u2014 true for automatic success, false for automatic failure",
          "title": "Result"
        },
        "value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Force the roll to a specific number (e.g., 20 to force a critical hit)",
          "title": "Value"
        }
      },
      "title": "Reroll",
      "type": "object"
    },
    "ResourceCost": {
      "description": "Cost in resource expenditure.\n\nExample: {\"amount\": 1, \"resource\": \"superiority_dice\"}",
      "properties": {
        "amount": {
          "description": "Numeric cost",
          "title": "Amount",
          "type": "number"
        },
        "resource": {
          "description": "Resource pool to spend from",
          "title": "Resource",
          "type": "string"
        }
      },
      "required": ["amount", "resource"],
      "title": "ResourceCost",
      "type": "object"
    },
    "ResourceCount": {
      "description": "Defines how the count of a resource pool is calculated.",
      "properties": {
        "type": {
          "description": "How count is determined",
          "enum": ["static", "class_level", "level_table", "formula", "ability_modifier"],
          "title": "Type",
          "type": "string"
        },
        "value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Static value or formula string (e.g., 'class_level.Monk', 'proficiency_bonus')",
          "title": "Value"
        },
        "class_name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Class name for level-based scaling (e.g., 'Fighter', 'Monk')",
          "title": "Class Name"
        },
        "values": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "integer"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Level-based values for level_table type (e.g., {'3': 4, '7': 5, '15': 6})",
          "title": "Values"
        },
        "ability": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Ability score for ability_modifier type (e.g., 'Charisma', 'Wisdom')",
          "title": "Ability"
        },
        "minimum": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Floor value (e.g., 1 to ensure at least 1 use even with negative modifier)",
          "title": "Minimum"
        }
      },
      "required": ["type"],
      "title": "ResourceCount",
      "type": "object"
    },
    "ResourceDieOperand": {
      "description": "A resource die value (e.g., bardic inspiration die).",
      "properties": {
        "type": {
          "const": "resource_die",
          "default": "resource_die",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Resource name (e.g., 'bardic_inspiration')",
          "title": "Value",
          "type": "string"
        }
      },
      "required": ["value"],
      "title": "ResourceDieOperand",
      "type": "object"
    },
    "ResourceMechanic": {
      "description": "A resource pool mechanic (type='resource') with resource-specific fields.",
      "properties": {
        "type": {
          "const": "resource",
          "description": "Must be 'resource'",
          "title": "Type",
          "type": "string"
        },
        "id": {
          "description": "Unique identifier for referencing (e.g., 'superiority_dice', 'ki_points')",
          "title": "Id",
          "type": "string"
        },
        "name": {
          "description": "Display name (e.g., 'Superiority Dice', 'Ki Points')",
          "title": "Name",
          "type": "string"
        },
        "count": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "string"
            },
            {
              "$ref": "#/$defs/ResourceCount"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Pool count - static int, formula string, or ResourceCount object",
          "title": "Count"
        },
        "recharge": {
          "$ref": "#/$defs/RechargeType",
          "description": "When the pool recharges"
        },
        "dice_sides": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Number of sides on the resource die (e.g., 8 for d8 superiority dice)",
          "title": "Dice Sides"
        },
        "scaling": {
          "anyOf": [
            {
              "$ref": "#/$defs/Scaling"
            },
            {
              "additionalProperties": {
                "$ref": "#/$defs/Scaling"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Level-based scaling for pool properties",
          "title": "Scaling"
        }
      },
      "required": ["type", "id", "name", "recharge"],
      "title": "ResourceMechanic",
      "type": "object"
    },
    "ResourceRequirement": {
      "description": "Requirement based on resource state.",
      "properties": {
        "type": {
          "const": "resource",
          "default": "resource",
          "title": "Type",
          "type": "string"
        },
        "resource": {
          "description": "Resource name (e.g., 'superiority_dice', 'rage', 'ki')",
          "title": "Resource",
          "type": "string"
        },
        "comparison": {
          "description": "Comparison operator",
          "enum": ["equals", "greater_than", "less_than"],
          "title": "Comparison",
          "type": "string"
        },
        "value": {
          "description": "Value to compare against",
          "title": "Value",
          "type": "integer"
        }
      },
      "required": ["resource", "comparison", "value"],
      "title": "ResourceRequirement",
      "type": "object"
    },
    "RetrainMechanic": {
      "description": "A retraining mechanic for swapping or adding character options at level-up.",
      "properties": {
        "type": {
          "const": "retrain",
          "description": "Must be 'retrain'",
          "title": "Type",
          "type": "string"
        },
        "name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Name of the retrain mechanic",
          "title": "Name"
        },
        "attribute": {
          "description": "Character attribute being modified (e.g., 'cantrips', 'fighting_styles')",
          "title": "Attribute",
          "type": "string"
        },
        "operation": {
          "description": "Operation type: 'replace' or 'add'",
          "title": "Operation",
          "type": "string"
        },
        "optional": {
          "default": true,
          "description": "Whether this retraining is optional",
          "title": "Optional",
          "type": "boolean"
        },
        "source": {
          "anyOf": [
            {
              "$ref": "#/$defs/RetrainSource"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Where replacements come from (list, filter, exclude)"
        }
      },
      "required": ["type", "attribute", "operation"],
      "title": "RetrainMechanic",
      "type": "object"
    },
    "RetrainSource": {
      "description": "Defines where replacement options come from during retraining.",
      "properties": {
        "list": {
          "description": "Data source or character attribute (e.g., 'spells', 'character.skill_proficiencies')",
          "title": "List",
          "type": "string"
        },
        "filter": {
          "anyOf": [
            {
              "additionalProperties": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "integer"
                  }
                ]
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Filter criteria (e.g., {'class': 'Bard', 'level': 0})",
          "title": "Filter"
        },
        "exclude": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Character attribute to exclude (e.g., 'character.skill_expertise')",
          "title": "Exclude"
        }
      },
      "required": ["list"],
      "title": "RetrainSource",
      "type": "object"
    },
    "Roll": {
      "description": "A dice roll with an optional success condition.\n\nExample \u2014 Divine Intervention percentile roll:\n{\n    \"type\": \"percentile\",\n    \"success\": {\n        \"comparison\": \"less_than_or_equal\",\n        \"value\": {\"attribute\": \"classes.Cleric.level\"}\n    }\n}",
      "properties": {
        "type": {
          "description": "Roll type (e.g., 'percentile')",
          "title": "Type",
          "type": "string"
        },
        "success": {
          "anyOf": [
            {
              "$ref": "#/$defs/SuccessCondition"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Condition that determines success"
        }
      },
      "required": ["type"],
      "title": "Roll",
      "type": "object"
    },
    "RollModifier": {
      "description": "Modifies how dice rolls are resolved.\n\nUsed for effects like \"maximize healing dice\", \"reroll 1s\", or \"add/subtract dice from roll\".\nSpecify either `function`, `reroll`, or `operation`+`value`.",
      "properties": {
        "function": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Function to apply to the roll (e.g., 'roller.max_roll', 'roller.reroll_ones')",
          "title": "Function"
        },
        "reroll": {
          "anyOf": [
            {
              "$ref": "#/$defs/Reroll"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Reroll dice showing specific values"
        },
        "operation": {
          "anyOf": [
            {
              "enum": ["add", "subtract"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Operation to apply to the roll result",
          "title": "Operation"
        },
        "value": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Value to add/subtract (e.g., 'superiority_die')",
          "title": "Value"
        }
      },
      "title": "RollModifier",
      "type": "object"
    },
    "RollResultOperand": {
      "description": "Reference to the result of a triggering roll.",
      "properties": {
        "type": {
          "const": "roll_result",
          "default": "roll_result",
          "title": "Type",
          "type": "string"
        }
      },
      "title": "RollResultOperand",
      "type": "object"
    },
    "RollThreshold": {
      "description": "The value a roll is compared against.\n\nCan be a static integer or a reference to a character attribute.",
      "properties": {
        "value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Static threshold value",
          "title": "Value"
        },
        "attribute": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Character attribute path (e.g., 'classes.Cleric.level')",
          "title": "Attribute"
        }
      },
      "title": "RollThreshold",
      "type": "object"
    },
    "Ruleset": {
      "enum": ["dnd5e_2024", "dnd5e", "dnd3.5e", "pf2e"],
      "title": "Ruleset",
      "type": "string"
    },
    "SaveAdvantage": {
      "description": "Conditions under which a target has advantage on a saving throw.",
      "properties": {
        "disposition": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target disposition that grants advantage (e.g., 'hostile')",
          "title": "Disposition"
        },
        "size": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/CreatureSize"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target sizes that grant advantage",
          "title": "Size"
        },
        "trigger": {
          "anyOf": [
            {
              "$ref": "#/$defs/Trigger"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Event that grants advantage on the save"
        }
      },
      "title": "SaveAdvantage",
      "type": "object"
    },
    "SavingThrow": {
      "description": "Defines a saving throw required by an effect or mechanic.",
      "properties": {
        "ability": {
          "description": "Ability used for the save (e.g., 'Dexterity', 'Wisdom')",
          "title": "Ability",
          "type": "string"
        },
        "dc": {
          "anyOf": [
            {
              "$ref": "#/$defs/DifficultyClass"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Difficulty class for the save. Omit when DC is derived from context (8 + proficiency + ability mod)."
        },
        "advantage": {
          "anyOf": [
            {
              "$ref": "#/$defs/SaveAdvantage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions granting advantage on this save"
        }
      },
      "required": ["ability"],
      "title": "SavingThrow",
      "type": "object"
    },
    "Scaling": {
      "description": "How a mechanic scales with level.",
      "properties": {
        "by_level": {
          "anyOf": [
            {
              "additionalProperties": {
                "anyOf": [
                  {
                    "type": "integer"
                  },
                  {
                    "type": "number"
                  },
                  {
                    "$ref": "#/$defs/RollModifier"
                  },
                  {
                    "type": "null"
                  }
                ]
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Values at specific levels",
          "title": "By Level"
        },
        "formula": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Formula for scaling (e.g., 'level / 2')",
          "title": "Formula"
        },
        "type": {
          "default": "character",
          "description": "Type of scaling (character or spell)",
          "title": "Type",
          "type": "string"
        },
        "components": {
          "anyOf": [
            {
              "additionalProperties": {
                "$ref": "#/$defs/Scaling"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Enables multi-component scaling",
          "title": "Components"
        }
      },
      "title": "Scaling",
      "type": "object"
    },
    "ScalingOperand": {
      "description": "Reference to a scaling value defined on the mechanic.",
      "properties": {
        "type": {
          "const": "scaling",
          "default": "scaling",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Scaling key (e.g., 'temp_hp', 'damage')",
          "title": "Value",
          "type": "string"
        }
      },
      "required": ["value"],
      "title": "ScalingOperand",
      "type": "object"
    },
    "ScalingReference": {
      "description": "Reference to a named scaling property.",
      "properties": {
        "scaling": {
          "description": "Name of the scaling property to reference (e.g., 'uses')",
          "title": "Scaling",
          "type": "string"
        }
      },
      "required": ["scaling"],
      "title": "ScalingReference",
      "type": "object"
    },
    "SizeRequirement": {
      "description": "Requirement based on creature size.",
      "properties": {
        "type": {
          "const": "size",
          "default": "size",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Allowed sizes (e.g., ['Tiny', 'Small', 'Medium', 'Large'])",
          "items": {
            "type": "string"
          },
          "title": "Value",
          "type": "array"
        }
      },
      "required": ["value"],
      "title": "SizeRequirement",
      "type": "object"
    },
    "SkillCheck": {
      "description": "A skill check against a difficulty class.\n\nExample \u2014 Snare (Investigation to spot the trap):\n{\"skill\": \"Investigation\", \"dc\": {\"ref\": \"spell_save_dc\"}}",
      "properties": {
        "skill": {
          "description": "Skill used for the check (e.g., 'Investigation', 'Perception')",
          "title": "Skill",
          "type": "string"
        },
        "dc": {
          "$ref": "#/$defs/DifficultyClass",
          "description": "Difficulty class for the check"
        }
      },
      "required": ["skill", "dc"],
      "title": "SkillCheck",
      "type": "object"
    },
    "Source": {
      "enum": ["phb", "tce", "scag", "xge"],
      "title": "Source",
      "type": "string"
    },
    "SpellImmunity": {
      "description": "Immunity to specific spells.",
      "properties": {
        "category": {
          "const": "spell",
          "default": "spell",
          "title": "Category",
          "type": "string"
        },
        "spell": {
          "description": "Spell names immune to (e.g., ['Magic Missile'])",
          "items": {
            "type": "string"
          },
          "title": "Spell",
          "type": "array"
        }
      },
      "required": ["spell"],
      "title": "SpellImmunity",
      "type": "object"
    },
    "SpellLevelCastOperand": {
      "description": "The level at which a spell was cast.",
      "properties": {
        "type": {
          "const": "spell_level_cast",
          "default": "spell_level_cast",
          "title": "Type",
          "type": "string"
        }
      },
      "title": "SpellLevelCastOperand",
      "type": "object"
    },
    "SpellLevelRequirement": {
      "description": "Requirement based on spell level.",
      "properties": {
        "type": {
          "const": "spell_level",
          "default": "spell_level",
          "title": "Type",
          "type": "string"
        },
        "minimum": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Minimum spell level",
          "title": "Minimum"
        },
        "maximum": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum spell level",
          "title": "Maximum"
        }
      },
      "title": "SpellLevelRequirement",
      "type": "object"
    },
    "SpellcastingMechanic": {
      "description": "A racial or trait-based innate spellcasting ability (e.g., Drow Magic).",
      "properties": {
        "type": {
          "const": "spellcasting",
          "description": "Must be 'spellcasting'",
          "title": "Type",
          "type": "string"
        },
        "name": {
          "description": "Display name of the spell (e.g., 'Dancing Lights')",
          "title": "Name",
          "type": "string"
        },
        "spell": {
          "description": "Spell identifier (e.g., 'dancing lights')",
          "title": "Spell",
          "type": "string"
        },
        "ability": {
          "description": "Spellcasting ability (e.g., 'Charisma')",
          "title": "Ability",
          "type": "string"
        },
        "components": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Spell components required (e.g., ['Verbal', 'Somatic'])",
          "title": "Components"
        },
        "uses": {
          "anyOf": [
            {
              "$ref": "#/$defs/Uses"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Usage limits before recharge"
        },
        "recharge": {
          "anyOf": [
            {
              "$ref": "#/$defs/RechargeType"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "When the ability recharges"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Requirements (e.g., minimum level)",
          "title": "Requirements"
        }
      },
      "required": ["type", "name", "spell", "ability"],
      "title": "SpellcastingMechanic",
      "type": "object"
    },
    "StatusConstraint": {
      "description": "Ongoing behavioral constraints imposed by a status condition.\n\nApplied on the target's turns while the status is active.\n\nExample \u2014 Turn Undead:\n{\n    \"movement\": {\"direction\": \"away\", \"relative_to\": \"character\"},\n    \"actions\": {\"blocked_actions\": [\"reaction\"], \"allowed_actions\": [\"Dash\", \"Dodge\"]}\n}\n\nExample \u2014 Frightened:\n{\n    \"movement\": {\"direction\": \"away\", \"relative_to\": \"source\"}\n}",
      "properties": {
        "movement": {
          "anyOf": [
            {
              "$ref": "#/$defs/MovementConstraint"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Movement restrictions on the target's turn"
        },
        "actions": {
          "anyOf": [
            {
              "$ref": "#/$defs/ActionConstraint"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Action restrictions on the target's turn"
        },
        "components": {
          "anyOf": [
            {
              "$ref": "#/$defs/ComponentConstraint"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Spell component restrictions (e.g., can't speak blocks verbal)"
        }
      },
      "title": "StatusConstraint",
      "type": "object"
    },
    "ComponentConstraint": {
      "description": "Spell component restrictions imposed by a status.\n\nBlocks specific spell components (verbal, somatic, material), preventing casting of spells that require those components unless bypassed (e.g., Subtle Spell metamagic).\n\nExample  Petrified (can't move or speak):\n{\"blocked\": [\"verbal\", \"somatic\"]}",
      "properties": {
        "blocked": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Spell components the creature cannot provide (e.g., 'verbal', 'somatic', 'material')"
        }
      },
      "required": ["blocked"],
      "title": "ComponentConstraint",
      "type": "object"
    },
    "StatusEffect": {
      "description": "Ongoing mechanical consequence of an active status.\n\nUsed within ApplyStatus.effect/effects to describe what the status does\nwhile active (e.g., disadvantage on attacks, bonus damage on hits).\n\nExample \u2014 Hex:\n{\"trigger\": {\"event\": [\"hit\"]}, \"damage_bonus\": {\"dice\": \"1d6\", \"type\": [\"necrotic\"]}}\n\nExample \u2014 Searing Smite (recurring damage):\n{\"trigger\": {\"event\": [\"start_turn\"]}, \"recurring_damage\": {\"dice\": \"1d6\", \"type\": [\"fire\"]}}",
      "properties": {
        "advantage": {
          "anyOf": [
            {
              "$ref": "#/$defs/AdvantageEffect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Grants advantage"
        },
        "disadvantage": {
          "anyOf": [
            {
              "$ref": "#/$defs/DisadvantageEffect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Grants disadvantage"
        },
        "roll_modifier": {
          "anyOf": [
            {
              "$ref": "#/$defs/RollModifier"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Modifies dice rolls"
        },
        "damage": {
          "anyOf": [
            {
              "$ref": "#/$defs/Damage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Damage dealt by this effect"
        },
        "damage_bonus": {
          "anyOf": [
            {
              "$ref": "#/$defs/Damage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Bonus damage applied"
        },
        "saving_throw": {
          "anyOf": [
            {
              "$ref": "#/$defs/SavingThrow"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Saving throw required by this effect"
        },
        "trigger": {
          "anyOf": [
            {
              "$ref": "#/$defs/Trigger"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Event that triggers this effect"
        },
        "duration": {
          "anyOf": [
            {
              "$ref": "#/$defs/Duration"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "How long this effect lasts"
        },
        "lighting": {
          "anyOf": [
            {
              "$ref": "#/$defs/Lighting"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Light emanation independent of an environment (e.g., Faerie Fire dim light)"
        },
        "negate": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions or statuses negated by this effect (e.g., ['invisible'])",
          "title": "Negate"
        },
        "recurring_damage": {
          "anyOf": [
            {
              "$ref": "#/$defs/Damage"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Damage that recurs while a status is active (e.g., Searing Smite fire damage)"
        },
        "grants": {
          "anyOf": [
            {
              "$ref": "#/$defs/Grant"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Action or ability granted"
        },
        "on_failure": {
          "anyOf": [
            {
              "$ref": "#/$defs/StatusEffect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What happens on a failed save"
        },
        "on_success": {
          "anyOf": [
            {
              "$ref": "#/$defs/StatusEffect"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What happens on a successful save"
        }
      },
      "title": "StatusEffect",
      "type": "object"
    },
    "StatusImmunity": {
      "description": "Immunity to one or more status conditions.",
      "properties": {
        "category": {
          "const": "status",
          "default": "status",
          "title": "Category",
          "type": "string"
        },
        "status": {
          "description": "Status conditions immune to (e.g., ['charmed', 'frightened'])",
          "items": {
            "type": "string"
          },
          "title": "Status",
          "type": "array"
        },
        "source": {
          "anyOf": [
            {
              "$ref": "#/$defs/ImmunitySource"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Source constraint (e.g., magical origin)"
        },
        "from": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity type the immunity applies against (e.g., 'protected_types')",
          "title": "From"
        },
        "modifier": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Scope qualifier (e.g., 'effects' for effect-only immunity)",
          "title": "Modifier"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "ability_check": "#/$defs/AbilityCheckRequirement",
                    "attack": "#/$defs/AttackRequirement",
                    "attack_result": "#/$defs/AttackResultRequirement",
                    "combat_state": "#/$defs/CombatStateRequirement",
                    "count": "#/$defs/CountRequirement",
                    "creature_type": "#/$defs/CreatureTypeRequirement",
                    "distance": "#/$defs/DistanceRequirement",
                    "effect_target": "#/$defs/EffectTargetRequirement",
                    "environment": "#/$defs/EnvironmentRequirement",
                    "equipment": "#/$defs/EquipmentRequirement",
                    "function": "#/$defs/FunctionRequirement",
                    "hit_points": "#/$defs/HitPointsRequirement",
                    "immunity": "#/$defs/ImmunityRequirement",
                    "inventory_item": "#/$defs/InventoryItemRequirement",
                    "level": "#/$defs/LevelRequirement",
                    "perception": "#/$defs/PerceptionRequirement",
                    "proximity": "#/$defs/ProximityRequirement",
                    "resource": "#/$defs/ResourceRequirement",
                    "size": "#/$defs/SizeRequirement",
                    "spell_level": "#/$defs/SpellLevelRequirement",
                    "status": "#/$defs/StatusRequirement",
                    "weapon_property": "#/$defs/WeaponPropertyRequirement"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "#/$defs/EquipmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/PerceptionRequirement"
                  },
                  {
                    "$ref": "#/$defs/WeaponPropertyRequirement"
                  },
                  {
                    "$ref": "#/$defs/StatusRequirement"
                  },
                  {
                    "$ref": "#/$defs/CreatureTypeRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackRequirement"
                  },
                  {
                    "$ref": "#/$defs/AttackResultRequirement"
                  },
                  {
                    "$ref": "#/$defs/InventoryItemRequirement"
                  },
                  {
                    "$ref": "#/$defs/AbilityCheckRequirement"
                  },
                  {
                    "$ref": "#/$defs/HitPointsRequirement"
                  },
                  {
                    "$ref": "#/$defs/SpellLevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/DistanceRequirement"
                  },
                  {
                    "$ref": "#/$defs/ProximityRequirement"
                  },
                  {
                    "$ref": "#/$defs/EffectTargetRequirement"
                  },
                  {
                    "$ref": "#/$defs/ImmunityRequirement"
                  },
                  {
                    "$ref": "#/$defs/LevelRequirement"
                  },
                  {
                    "$ref": "#/$defs/CombatStateRequirement"
                  },
                  {
                    "$ref": "#/$defs/EnvironmentRequirement"
                  },
                  {
                    "$ref": "#/$defs/ResourceRequirement"
                  },
                  {
                    "$ref": "#/$defs/SizeRequirement"
                  },
                  {
                    "$ref": "#/$defs/CountRequirement"
                  },
                  {
                    "$ref": "#/$defs/FunctionRequirement"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions that must be met for this immunity",
          "title": "Requirements"
        }
      },
      "required": ["status"],
      "title": "StatusImmunity",
      "type": "object"
    },
    "StatusRequirement": {
      "description": "Status-based requirement.",
      "properties": {
        "type": {
          "const": "status",
          "default": "status",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "description": "Status(es) that must be active",
          "title": "Value"
        },
        "negate": {
          "default": false,
          "description": "If true, status must NOT be active",
          "title": "Negate",
          "type": "boolean"
        }
      },
      "required": ["value"],
      "title": "StatusRequirement",
      "type": "object"
    },
    "StringOperand": {
      "description": "A static string value.",
      "properties": {
        "type": {
          "const": "string",
          "default": "string",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "String value",
          "title": "Value",
          "type": "string"
        }
      },
      "required": ["value"],
      "title": "StringOperand",
      "type": "object"
    },
    "SuccessCondition": {
      "description": "Defines when a roll succeeds.",
      "properties": {
        "comparison": {
          "description": "How the roll result is compared to the threshold",
          "enum": ["equals", "not_equals", "greater_than", "less_than", "greater_than_or_equal", "less_than_or_equal"],
          "title": "Comparison",
          "type": "string"
        },
        "value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "#/$defs/RollThreshold"
            }
          ],
          "description": "Threshold \u2014 static int or attribute reference",
          "title": "Value"
        }
      },
      "required": ["comparison", "value"],
      "title": "SuccessCondition",
      "type": "object"
    },
    "Surface": {
      "description": "Surface type in the area. Save/effect logic belongs at Effect level.\n\nExamples:\n- Grease: slippery\n- Web: webbed\n- Create Bonfire: burning",
      "properties": {
        "type": {
          "description": "Type of surface",
          "enum": ["normal", "slippery", "sticky", "unstable", "webbed", "burning", "frozen"],
          "title": "Type",
          "type": "string"
        }
      },
      "required": ["type"],
      "title": "Surface",
      "type": "object"
    },
    "Sustained": {
      "description": "Sustained effect that can be repeated on subsequent turns.\n\nExample \u2014 Witch Bolt:\n{\"cost\": \"action\", \"damage\": {\"dice\": \"1d12\", \"type\": [\"lightning\"], \"auto_hit\": true}, \"target\": {...}}",
      "properties": {
        "cost": {
          "description": "Action cost to sustain (e.g., 'action', 'bonus_action')",
          "title": "Cost",
          "type": "string"
        },
        "damage": {
          "$ref": "#/$defs/Damage",
          "description": "Damage dealt each time the effect is sustained"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/Target"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target requirements to maintain the sustained effect"
        }
      },
      "required": ["cost", "damage"],
      "title": "Sustained",
      "type": "object"
    },
    "Target": {
      "description": "Defines who or what is targeted by an effect.",
      "properties": {
        "type": {
          "description": "Category of target or reference to contextual entity",
          "enum": [
            "self",
            "creature",
            "creatures",
            "object",
            "weapon",
            "magic_item",
            "point",
            "resource",
            "entity",
            "attacker",
            "attackers",
            "event_actor",
            "event_recipient"
          ],
          "title": "Type",
          "type": "string"
        },
        "count": {
          "anyOf": [
            {
              "minimum": 1,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum number of targets (for 'creatures' type or limited selections)",
          "title": "Count"
        },
        "disposition": {
          "anyOf": [
            {
              "enum": ["friendly", "hostile", "neutral", "any", "willing"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Relationship of target to the character",
          "title": "Disposition"
        },
        "include_self": {
          "default": false,
          "description": "Whether the character can target themselves (for area effects)",
          "title": "Include Self",
          "type": "boolean"
        },
        "value": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target value(s) - e.g., ['fire'] for object targets",
          "title": "Value"
        },
        "order": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Order to process targets - e.g., 'ascending' for lowest HP first",
          "title": "Order"
        },
        "requirements": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/TargetRequirement"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions that potential targets must meet",
          "title": "Requirements"
        }
      },
      "required": ["type"],
      "title": "Target",
      "type": "object"
    },
    "TargetRequirement": {
      "description": "A condition that potential targets must meet.",
      "properties": {
        "type": {
          "description": "Type of requirement",
          "enum": [
            "perception",
            "creature_type",
            "size",
            "status",
            "equipment",
            "hit_points",
            "immunity",
            "range",
            "spent_hit_dice",
            "function",
            "area",
            "distance",
            "property"
          ],
          "title": "Type",
          "type": "string"
        },
        "disabled": {
          "default": false,
          "description": "Skip enforcement of this requirement (intent preserved in data)",
          "title": "Disabled",
          "type": "boolean"
        },
        "observer": {
          "anyOf": [
            {
              "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity that must perceive (required for perception type)",
          "title": "Observer"
        },
        "subject": {
          "anyOf": [
            {
              "enum": ["character", "target", "source", "attacker", "ally", "illusion"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity that must be perceived (required for perception type)",
          "title": "Subject"
        },
        "senses": {
          "anyOf": [
            {
              "items": {
                "enum": ["sight", "hearing"],
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Required senses: sight, hearing (required for perception type)",
          "title": "Senses"
        },
        "negate": {
          "default": false,
          "description": "If true, observer must NOT perceive subject (perception type only)",
          "title": "Negate",
          "type": "boolean"
        },
        "value": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Required value(s) - for non-perception types",
          "title": "Value"
        },
        "match": {
          "default": "all",
          "description": "For array values/senses, whether any or all must match",
          "enum": ["any", "all"],
          "title": "Match",
          "type": "string"
        },
        "modifier": {
          "anyOf": [
            {
              "const": "not",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Negates the requirement (e.g., NOT immune to frightened)",
          "title": "Modifier"
        },
        "minimum": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Minimum value (for numeric requirements like spent_hit_dice)",
          "title": "Minimum"
        },
        "function": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Function name for 'function' type requirements",
          "title": "Function"
        },
        "context": {
          "anyOf": [
            {
              "enum": ["character", "target"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Context for function evaluation",
          "title": "Context"
        },
        "comparison": {
          "anyOf": [
            {
              "enum": [
                "equals",
                "not_equals",
                "greater_than",
                "less_than",
                "greater_than_or_equal",
                "less_than_or_equal",
                "within"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Comparison operator for requirement evaluation",
          "title": "Comparison"
        },
        "attribute": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Attribute to check (e.g., 'hit_points')",
          "title": "Attribute"
        },
        "calculation": {
          "anyOf": [
            {
              "$ref": "#/$defs/Calculation"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Calculated value to compare against"
        },
        "unit": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Unit for range/distance requirements (e.g., 'feet')",
          "title": "Unit"
        },
        "to": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Reference entity for distance requirements",
          "title": "To"
        },
        "area": {
          "anyOf": [
            {
              "$ref": "#/$defs/Area"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Area constraint for area-type requirements"
        },
        "from_action": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Filter status to one applied by this action",
          "title": "From Action"
        },
        "from_source": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Filter status to one applied by this entity",
          "title": "From Source"
        }
      },
      "required": ["type"],
      "title": "TargetRequirement",
      "type": "object"
    },
    "Terrain": {
      "description": "Movement and terrain effects in the area.\n\nExamples:\n- Spike Growth: difficult terrain\n- Web: difficult terrain (with other effects)\n- Wall of Stone: impassable",
      "properties": {
        "type": {
          "description": "Type of terrain",
          "enum": ["normal", "difficult", "greater_difficult", "impassable"],
          "title": "Type",
          "type": "string"
        },
        "cost_multiplier": {
          "anyOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Movement cost multiplier (2.0 for difficult terrain, 3.0 for greater difficult)",
          "title": "Cost Multiplier"
        }
      },
      "required": ["type"],
      "title": "Terrain",
      "type": "object"
    },
    "Timing": {
      "description": "When during an event a feature can be activated.\n\nThis is a unified schema that works across all event types:\n- For rolls: before=before dice rolled, after=saw die/before result, resolved=know result\n- For actions: before=before action, after=action complete (often same as resolved)",
      "enum": ["before", "after", "resolved"],
      "title": "Timing",
      "type": "string"
    },
    "Trigger": {
      "description": "Defines when a mechanic activates based on game events.",
      "properties": {
        "event": {
          "description": "The event(s) that trigger this mechanic",
          "items": {
            "$ref": "#/$defs/TriggerEvent"
          },
          "title": "Event",
          "type": "array"
        },
        "timing": {
          "anyOf": [
            {
              "$ref": "#/$defs/Timing"
            },
            {
              "items": {
                "$ref": "#/$defs/Timing"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "When during the event this can activate: before, after, or resolved. Use list for multiple valid timings.",
          "title": "Timing"
        },
        "action": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "The action that triggered this event (e.g., 'attack', 'dash', 'cast_spell')",
          "title": "Action"
        },
        "result": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Result of the triggering event: 'success' or 'failure'. Context determines meaning (hit/miss for attacks, pass/fail for saves).",
          "title": "Result"
        },
        "effect": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Effect type(s) of the triggering spell or ability (e.g., ['healing'], ['healing', 'damage']).",
          "title": "Effect"
        },
        "spell_level": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Minimum spell level at casting (0 for cantrips). Triggers on spells cast at this level or higher.",
          "title": "Spell Level"
        },
        "status": {
          "anyOf": [
            {
              "$ref": "#/$defs/TriggerStatus"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "For status_applied/status_removed events, specifies which status"
        },
        "source": {
          "anyOf": [
            {
              "$ref": "#/$defs/TriggerSource"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "What caused the triggering event"
        },
        "target": {
          "anyOf": [
            {
              "$ref": "#/$defs/TriggerTarget"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Who the event applies to"
        },
        "condition": {
          "anyOf": [
            {
              "$ref": "#/$defs/TriggerCondition"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Additional condition that must be met"
        },
        "damage_type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Filter by damage type(s)",
          "title": "Damage Type"
        }
      },
      "required": ["event"],
      "title": "Trigger",
      "type": "object"
    },
    "TriggerCondition": {
      "description": "Condition for a trigger to fire.",
      "properties": {
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Type of condition (perception, range, status)",
          "title": "Type"
        },
        "value": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Condition value",
          "title": "Value"
        },
        "unit": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Unit for range conditions (feet, miles)",
          "title": "Unit"
        },
        "comparison": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Comparison operator (greater_than, less_than, equal)",
          "title": "Comparison"
        },
        "to": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Reference point (e.g., 'character')",
          "title": "To"
        }
      },
      "title": "TriggerCondition",
      "type": "object"
    },
    "TriggerEvent": {
      "description": "Events that can trigger a mechanic.",
      "enum": [
        "targeted_by",
        "damage",
        "damaged_by",
        "heal",
        "healed_by",
        "attack",
        "attacked_by",
        "hit",
        "hit_by",
        "miss",
        "missed_by",
        "cast_spell",
        "status_applied",
        "status_removed",
        "start_turn",
        "end_turn",
        "combat_start",
        "move",
        "move_end",
        "enter_area",
        "leave_area",
        "ability_check",
        "saving_throw",
        "short_rest",
        "long_rest",
        "initiative_roll",
        "equip",
        "unequip"
      ],
      "title": "TriggerEvent",
      "type": "string"
    },
    "TriggerImmunity": {
      "description": "Immunity to a triggered event (e.g., opportunity attack).",
      "properties": {
        "category": {
          "const": "trigger",
          "default": "trigger",
          "title": "Category",
          "type": "string"
        },
        "to": {
          "description": "Trigger immune to (e.g., 'opportunity_attack')",
          "title": "To",
          "type": "string"
        },
        "from": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Entity the immunity applies against (e.g., 'attack_target')",
          "title": "From"
        }
      },
      "required": ["to"],
      "title": "TriggerImmunity",
      "type": "object"
    },
    "TriggerSource": {
      "description": "Describes the source of a triggering event.",
      "properties": {
        "type": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Type(s) of source (creature, spell, weapon, environment, melee, ranged)",
          "title": "Type"
        },
        "origin": {
          "anyOf": [
            {
              "$ref": "#/$defs/Origin"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Origin of the source: 'magical' or 'nonmagical'"
        },
        "range": {
          "anyOf": [
            {
              "$ref": "#/$defs/Distance"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Range constraint on the source"
        },
        "perception": {
          "anyOf": [
            {
              "$ref": "#/$defs/Perception"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Perception requirement (e.g., character must see source)"
        },
        "resource": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Resource pool that is the source (e.g., 'hit_dice')",
          "title": "Resource"
        },
        "disposition": {
          "anyOf": [
            {
              "enum": ["friendly", "hostile", "any"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Relationship of the source to the caster (e.g., 'friendly' for allied creatures)",
          "title": "Disposition"
        }
      },
      "title": "TriggerSource",
      "type": "object"
    },
    "TriggerStatus": {
      "description": "Status reference for status-based triggers.",
      "properties": {
        "name": {
          "description": "Name of the status",
          "title": "Name",
          "type": "string"
        },
        "on": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether trigger fires on 'applied' or 'removed'",
          "title": "On"
        }
      },
      "required": ["name"],
      "title": "TriggerStatus",
      "type": "object"
    },
    "TriggerTarget": {
      "description": "Who the triggering event applies to.",
      "properties": {
        "type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Target type(s) (e.g., 'self', 'ally', 'affected_creature')",
          "title": "Type"
        },
        "size": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/CreatureSize"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Size(s) of creature that can trigger",
          "title": "Size"
        },
        "range": {
          "anyOf": [
            {
              "$ref": "#/$defs/Distance"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Range constraint"
        },
        "exclude": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Exclude a specific target from matching (e.g., 'spell_target')",
          "title": "Exclude"
        }
      },
      "title": "TriggerTarget",
      "type": "object"
    },
    "Uses": {
      "description": "How many times an ability can be used before recharging.",
      "properties": {
        "value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Static number of uses",
          "title": "Value"
        },
        "calculation": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Attribute reference (e.g., 'scores.wisdom.modifier')",
          "title": "Calculation"
        },
        "minimum": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Floor value for calculated uses",
          "title": "Minimum"
        }
      },
      "title": "Uses",
      "type": "object"
    },
    "Visibility": {
      "description": "How the area affects vision and perception.\n\nExamples:\n- Fog Cloud: heavily obscured\n- Light rain: lightly obscured\n- Wall of Stone: blocked",
      "properties": {
        "level": {
          "description": "Visibility level in the area",
          "enum": ["clear", "lightly_obscured", "heavily_obscured", "blocked"],
          "title": "Level",
          "type": "string"
        },
        "blocks_darkvision": {
          "default": false,
          "description": "Whether the effect blocks darkvision (e.g., magical darkness)",
          "title": "Blocks Darkvision",
          "type": "boolean"
        }
      },
      "required": ["level"],
      "title": "Visibility",
      "type": "object"
    },
    "WeaponPropertyRequirement": {
      "description": "Weapon property requirement.",
      "properties": {
        "type": {
          "const": "weapon_property",
          "default": "weapon_property",
          "title": "Type",
          "type": "string"
        },
        "value": {
          "description": "Weapon must have one of these properties",
          "items": {
            "type": "string"
          },
          "title": "Value",
          "type": "array"
        }
      },
      "required": ["value"],
      "title": "WeaponPropertyRequirement",
      "type": "object"
    }
  }
}
