{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "D&D 5e Spells",
  "type": "array",
  "items": {
    "description": "Spell definition.",
    "properties": {
      "name": {
        "description": "Spell name",
        "title": "Name",
        "type": "string"
      },
      "description": {
        "anyOf": [
          {
            "type": "string"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Spell description",
        "title": "Description"
      },
      "level": {
        "description": "Spell level (0-9, 0=Cantrip)",
        "title": "Level",
        "type": "integer"
      },
      "components": {
        "description": "List of components",
        "items": {
          "$ref": "#/$defs/ComponentType"
        },
        "title": "Components",
        "type": "array"
      },
      "casting_time": {
        "$ref": "#/$defs/Action",
        "description": "Time needed to cast"
      },
      "materials": {
        "anyOf": [
          {
            "items": {
              "$ref": "#/$defs/MaterialCost"
            },
            "type": "array"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "List of material components, if any",
        "title": "Materials"
      },
      "damage": {
        "anyOf": [
          {
            "$ref": "common.schema.json#/$defs/Damage"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Spell damage"
      },
      "resistances": {
        "anyOf": [
          {
            "items": {
              "$ref": "common.schema.json#/$defs/DamageType"
            },
            "type": "array"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Resistances provided, if any",
        "title": "Resistances"
      },
      "immunities": {
        "anyOf": [
          {
            "items": {
              "$ref": "common.schema.json#/$defs/DamageType"
            },
            "type": "array"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Immunities provided, if any",
        "title": "Immunities"
      },
      "scaling": {
        "anyOf": [
          {
            "$ref": "common.schema.json#/$defs/Scaling"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "How the spell scales with level"
      },
      "concentration": {
        "description": "Whether the spell requires concentration",
        "title": "Concentration",
        "type": "boolean"
      },
      "mechanics": {
        "description": "Structured game mechanics for this spell",
        "items": {
          "discriminator": {
            "mapping": {
              "action": "#/$defs/BaseMechanic",
              "advantage": "#/$defs/BaseMechanic",
              "bonus_action": "#/$defs/BaseMechanic",
              "choice": "#/$defs/ChoiceMechanic",
              "critical_hit": "#/$defs/BaseMechanic",
              "damage_bonus": "#/$defs/BaseMechanic",
              "extra_attack": "#/$defs/BaseMechanic",
              "extra_turn": "#/$defs/BaseMechanic",
              "granted_spells": "#/$defs/GrantedSpellsMechanic",
              "immunity": "#/$defs/BaseMechanic",
              "movement": "#/$defs/BaseMechanic",
              "optional": "#/$defs/BaseMechanic",
              "passive": "#/$defs/BaseMechanic",
              "proficiency": "#/$defs/ProficiencyMechanic",
              "reaction": "#/$defs/BaseMechanic",
              "resistance": "#/$defs/BaseMechanic",
              "resource": "#/$defs/ResourceMechanic",
              "retrain": "#/$defs/RetrainMechanic",
              "ritual": "#/$defs/BaseMechanic",
              "special": "#/$defs/BaseMechanic",
              "spellcasting": "#/$defs/SpellcastingMechanic"
            },
            "propertyName": "type"
          },
          "oneOf": [
            {
              "$ref": "common.schema.json#/$defs/ResourceMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/ChoiceMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/RetrainMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/SpellcastingMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/GrantedSpellsMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/ProficiencyMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/BaseMechanic"
            }
          ]
        },
        "title": "Mechanics",
        "type": "array"
      },
      "classes": {
        "description": "Which classes have access to the spell",
        "items": {
          "type": "string"
        },
        "title": "Classes",
        "type": "array"
      },
      "school": {
        "$ref": "#/$defs/School",
        "description": "Which school of magic the spell belongs to"
      },
      "range": {
        "$ref": "#/$defs/Range",
        "description": "Range for spell (touch or ranged)"
      },
      "distance": {
        "anyOf": [
          {
            "type": "integer"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Distance of spell if ranged",
        "title": "Distance"
      },
      "duration_units": {
        "anyOf": [
          {
            "type": "string"
          },
          {
            "type": "null"
          }
        ],
        "default": "rounds",
        "description": "Unit type of duration (usually rounds)",
        "title": "Duration Units"
      },
      "duration": {
        "default": 0,
        "description": "Unit count of duration",
        "title": "Duration",
        "type": "integer"
      },
      "source": {
        "$ref": "common.schema.json#/$defs/Source",
        "description": "Source book"
      },
      "ruleset": {
        "$ref": "common.schema.json#/$defs/Ruleset",
        "description": "Ruleset version"
      }
    },
    "required": [
      "name",
      "level",
      "components",
      "casting_time",
      "concentration",
      "classes",
      "school",
      "range",
      "source",
      "ruleset"
    ],
    "title": "Spell",
    "type": "object"
  },
  "$defs": {
    "Action": {
      "enum": [
        "Action",
        "Bonus Action",
        "Reaction",
        "Minute",
        "Hour"
      ],
      "title": "Action",
      "type": "string"
    },
    "ComponentType": {
      "enum": [
        "Verbal",
        "Somatic",
        "Material"
      ],
      "title": "ComponentType",
      "type": "string"
    },
    "MaterialCost": {
      "description": "Material component for a spell.",
      "properties": {
        "name": {
          "description": "Material name",
          "title": "Name",
          "type": "string"
        },
        "cost": {
          "anyOf": [
            {
              "$ref": "common.schema.json#/$defs/CurrencyCost"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Cost with currency (None for materials with no specified cost)"
        }
      },
      "required": [
        "name"
      ],
      "title": "MaterialCost",
      "type": "object"
    },
    "Range": {
      "enum": [
        "Touch",
        "Range",
        "Self"
      ],
      "title": "Range",
      "type": "string"
    },
    "School": {
      "enum": [
        "Abjuration",
        "Conjuration",
        "Divination",
        "Enchantment",
        "Evocation",
        "Illusion",
        "Necromancy",
        "Transmutation"
      ],
      "title": "School",
      "type": "string"
    }
  }
}
