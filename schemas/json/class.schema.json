{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "D&D 5e Classes",
  "type": "array",
  "items": {
    "description": "Complete D&D 5e class definition.",
    "properties": {
      "name": {
        "description": "Name of the class",
        "title": "Name",
        "type": "string"
      },
      "source": {
        "description": "Source book or material",
        "title": "Source",
        "type": "string"
      },
      "ruleset": {
        "description": "Ruleset for the class",
        "title": "Ruleset",
        "type": "string"
      },
      "description": {
        "description": "Flavor text describing the class and its role",
        "title": "Description",
        "type": "string"
      },
      "base_class": {
        "anyOf": [
          {
            "type": "string"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Base class name (for subclasses/archetypes)",
        "title": "Base Class"
      },
      "subclass_label": {
        "anyOf": [
          {
            "type": "string"
          },
          {
            "type": "null"
          }
        ],
        "default": "Subclass",
        "description": "Display label for subclass type",
        "title": "Subclass Label"
      },
      "hit_die": {
        "$ref": "#/$defs/HitDice",
        "description": "Hit die size"
      },
      "primary_ability": {
        "anyOf": [
          {
            "items": {
              "$ref": "common.schema.json#/$defs/Ability"
            },
            "type": "array"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Primary ability score(s)",
        "title": "Primary Ability"
      },
      "saving_throw_proficiencies": {
        "description": "Saving throw proficiencies",
        "items": {
          "$ref": "common.schema.json#/$defs/Ability"
        },
        "maxItems": 2,
        "minItems": 2,
        "title": "Saving Throw Proficiencies",
        "type": "array"
      },
      "proficiencies": {
        "$ref": "#/$defs/Proficiencies",
        "description": "All proficiencies granted by this class"
      },
      "starting_equipment": {
        "anyOf": [
          {
            "items": {},
            "type": "array"
          },
          {
            "additionalProperties": true,
            "type": "object"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Starting equipment - various formats: list of dicts, list of strings, or dict with choices/granted",
        "title": "Starting Equipment"
      },
      "multiclassing": {
        "anyOf": [
          {
            "additionalProperties": true,
            "type": "object"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Multiclassing requirements structure",
        "title": "Multiclassing"
      },
      "spellcasting": {
        "anyOf": [
          {
            "$ref": "#/$defs/Spellcasting"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Spellcasting information if class can cast spells"
      },
      "resource_pools": {
        "anyOf": [
          {
            "items": {
              "$ref": "#/$defs/ResourcePool"
            },
            "type": "array"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Class-wide resource pools (e.g., Ki Points for Monk, Sorcery Points for Sorcerer)",
        "title": "Resource Pools"
      },
      "class_table": {
        "anyOf": [
          {
            "$ref": "#/$defs/ClassTable"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Level progression table"
      },
      "class_features": {
        "anyOf": [
          {
            "items": {
              "$ref": "#/$defs/ClassFeature"
            },
            "type": "array"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Detailed class features",
        "title": "Class Features"
      },
      "subclasses": {
        "anyOf": [
          {
            "items": {
              "$ref": "#/$defs/Subclass"
            },
            "type": "array"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Available subclasses for this class",
        "title": "Subclasses"
      }
    },
    "required": ["name", "source", "ruleset", "description", "hit_die", "saving_throw_proficiencies", "proficiencies"],
    "title": "DndClass",
    "type": "object"
  },
  "$defs": {
    "ClassFeature": {
      "description": "A class feature with full details and mechanics.",
      "properties": {
        "name": {
          "description": "Feature name",
          "title": "Name",
          "type": "string"
        },
        "level": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            }
          ],
          "description": "Level(s) at which feature is gained",
          "title": "Level"
        },
        "description": {
          "description": "Full text description of the feature",
          "title": "Description",
          "type": "string"
        },
        "mechanics": {
          "description": "Structured game mechanics for this feature",
          "items": {
            "discriminator": {
              "mapping": {
                "action": "#/$defs/BaseMechanic",
                "advantage": "#/$defs/BaseMechanic",
                "bonus_action": "#/$defs/BaseMechanic",
                "choice": "#/$defs/ChoiceMechanic",
                "critical_hit": "#/$defs/BaseMechanic",
                "damage_bonus": "#/$defs/BaseMechanic",
                "extra_attack": "#/$defs/BaseMechanic",
                "extra_turn": "#/$defs/BaseMechanic",
                "granted_spells": "#/$defs/GrantedSpellsMechanic",
                "immunity": "#/$defs/BaseMechanic",
                "movement": "#/$defs/BaseMechanic",
                "optional": "#/$defs/BaseMechanic",
                "passive": "#/$defs/BaseMechanic",
                "proficiency": "#/$defs/ProficiencyMechanic",
                "reaction": "#/$defs/BaseMechanic",
                "resistance": "#/$defs/BaseMechanic",
                "resource": "#/$defs/ResourceMechanic",
                "retrain": "#/$defs/RetrainMechanic",
                "ritual": "#/$defs/BaseMechanic",
                "special": "#/$defs/BaseMechanic",
                "spellcasting": "#/$defs/SpellcastingMechanic"
              },
              "propertyName": "type"
            },
            "oneOf": [
              {
                "$ref": "common.schema.json#/$defs/ResourceMechanic"
              },
              {
                "$ref": "common.schema.json#/$defs/ChoiceMechanic"
              },
              {
                "$ref": "common.schema.json#/$defs/RetrainMechanic"
              },
              {
                "$ref": "common.schema.json#/$defs/SpellcastingMechanic"
              },
              {
                "$ref": "common.schema.json#/$defs/GrantedSpellsMechanic"
              },
              {
                "$ref": "common.schema.json#/$defs/ProficiencyMechanic"
              },
              {
                "$ref": "common.schema.json#/$defs/BaseMechanic"
              }
            ]
          },
          "title": "Mechanics",
          "type": "array"
        },
        "class": {
          "description": "Class this feature belongs to",
          "title": "Class",
          "type": "string"
        },
        "source": {
          "description": "Source book or material",
          "title": "Source",
          "type": "string"
        },
        "ruleset": {
          "description": "Ruleset for the feature",
          "title": "Ruleset",
          "type": "string"
        },
        "triggered_by": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Name of another feature that triggers this feature (e.g., 'Ability Score Improvement')",
          "title": "Triggered By"
        },
        "extends": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of parent feature names this feature builds on. Both the parent and this feature appear as separate actions in the action list (e.g., Frenzy extends Rage \u2014 both are available).",
          "title": "Extends"
        },
        "enhances": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Name of feature this feature modifies in place. Only the base feature appears in the action list; the enhancement upgrades its behavior (e.g., Destroy Undead enhances Turn Undead, Persistent Rage enhances Rage).",
          "title": "Enhances"
        },
        "subfeatures": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/Subfeature"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Sub-features or options within this feature",
          "title": "Subfeatures"
        }
      },
      "required": ["name", "level", "description", "mechanics", "class", "source", "ruleset"],
      "title": "ClassFeature",
      "type": "object"
    },
    "ClassTable": {
      "description": "Level progression table for a class.",
      "properties": {
        "columns": {
          "description": "Column headers (excluding Level and Proficiency Bonus)",
          "items": {
            "type": "string"
          },
          "title": "Columns",
          "type": "array"
        },
        "rows": {
          "description": "Progression data by level",
          "items": {
            "$ref": "#/$defs/ClassTableRow"
          },
          "title": "Rows",
          "type": "array"
        }
      },
      "required": ["columns", "rows"],
      "title": "ClassTable",
      "type": "object"
    },
    "ClassTableRow": {
      "description": "A row in the class progression table.",
      "properties": {
        "level": {
          "description": "Character level",
          "maximum": 20,
          "minimum": 1,
          "title": "Level",
          "type": "integer"
        },
        "proficiency_bonus": {
          "description": "Proficiency bonus at this level",
          "maximum": 6,
          "minimum": 2,
          "title": "Proficiency Bonus",
          "type": "integer"
        },
        "features": {
          "description": "Features gained at this level",
          "items": {
            "type": "string"
          },
          "title": "Features",
          "type": "array"
        },
        "class_specific": {
          "additionalProperties": true,
          "description": "Class-specific columns (e.g., Sneak Attack, Rage, Ki Points)",
          "title": "Class Specific",
          "type": "object"
        }
      },
      "required": ["level", "proficiency_bonus", "features"],
      "title": "ClassTableRow",
      "type": "object"
    },
    "FixedToolProficiency": {
      "description": "A fixed tool proficiency that is automatically granted.",
      "properties": {
        "type": {
          "const": "fixed",
          "default": "fixed",
          "title": "Type",
          "type": "string"
        },
        "items": {
          "description": "Tools granted as proficiencies",
          "items": {
            "type": "string"
          },
          "title": "Items",
          "type": "array"
        }
      },
      "required": ["items"],
      "title": "FixedToolProficiency",
      "type": "object"
    },
    "HitDice": {
      "enum": [4, 6, 8, 10, 12, 20, 100],
      "title": "HitDice",
      "type": "integer"
    },
    "LevelSpells": {
      "description": "The state of spells known at a specific character level.",
      "properties": {
        "total_slots": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Total count (optional validation)",
          "title": "Total Slots"
        },
        "fixed": {
          "description": "Specific named spells automatically granted (e.g., ['Mage Hand'])",
          "items": {
            "type": "string"
          },
          "title": "Fixed",
          "type": "array"
        },
        "choices": {
          "description": "Rules for picking the remaining spells",
          "items": {
            "$ref": "#/$defs/SpellChoice"
          },
          "title": "Choices",
          "type": "array"
        }
      },
      "title": "LevelSpells",
      "type": "object"
    },
    "Proficiencies": {
      "description": "All proficiencies granted by a class.",
      "properties": {
        "armor": {
          "description": "Armor proficiencies",
          "items": {
            "type": "string"
          },
          "title": "Armor",
          "type": "array"
        },
        "weapons": {
          "description": "Weapon proficiencies",
          "items": {
            "type": "string"
          },
          "title": "Weapons",
          "type": "array"
        },
        "tools": {
          "description": "Tool proficiencies (fixed grants or choices)",
          "items": {
            "anyOf": [
              {
                "$ref": "#/$defs/FixedToolProficiency"
              },
              {
                "$ref": "#/$defs/ToolProficiencyChoice"
              }
            ]
          },
          "title": "Tools",
          "type": "array"
        },
        "skills": {
          "anyOf": [
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "$ref": "#/$defs/ProficiencyChoice"
            }
          ],
          "description": "Skill proficiency choices or configuration",
          "title": "Skills"
        }
      },
      "title": "Proficiencies",
      "type": "object"
    },
    "ProficiencyChoice": {
      "description": "Skill proficiency selection.",
      "properties": {
        "choose": {
          "description": "Number of skills to choose",
          "title": "Choose",
          "type": "integer"
        },
        "from": {
          "description": "Skills available to choose from",
          "items": {
            "$ref": "#/$defs/Skill"
          },
          "title": "From",
          "type": "array"
        }
      },
      "required": ["choose", "from"],
      "title": "ProficiencyChoice",
      "type": "object"
    },
    "ResourcePool": {
      "description": "Defines a custom resource pool for a class or subclass.\n\nExamples: Ki Points, Superiority Dice, Channel Divinity, Spell Slots",
      "properties": {
        "id": {
          "description": "Unique identifier (e.g., 'superiority_dice', 'ki_points', 'spell_slots_1')",
          "title": "Id",
          "type": "string"
        },
        "name": {
          "description": "Display name (e.g., 'Superiority Dice', 'Ki Points')",
          "title": "Name",
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Explanation of what this resource is used for",
          "title": "Description"
        },
        "count": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "string"
            },
            {
              "$ref": "common.schema.json#/$defs/ResourceCount"
            }
          ],
          "description": "Pool count - can be static int, formula string, or ResourceCount object",
          "title": "Count"
        },
        "recharge": {
          "description": "When pool recharges: 'short_rest', 'long_rest', 'turn', 'round', 'dawn', 'none', 'special'",
          "title": "Recharge",
          "type": "string"
        },
        "metadata": {
          "anyOf": [
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Additional data (e.g., dice_sides for superiority dice, slot_level for spells)",
          "title": "Metadata"
        },
        "scaling": {
          "anyOf": [
            {
              "additionalProperties": {
                "$ref": "common.schema.json#/$defs/Scaling"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Scaling for pool properties by level",
          "title": "Scaling"
        }
      },
      "required": ["id", "name", "count", "recharge"],
      "title": "ResourcePool",
      "type": "object"
    },
    "Skill": {
      "enum": [
        "Acrobatics",
        "Animal Handling",
        "Arcana",
        "Athletics",
        "Deception",
        "History",
        "Insight",
        "Intimidation",
        "Investigation",
        "Medicine",
        "Nature",
        "Perception",
        "Performance",
        "Persuasion",
        "Religion",
        "Sleight of Hand",
        "Stealth",
        "Survival"
      ],
      "title": "Skill",
      "type": "string"
    },
    "SpellChoice": {
      "description": "Defines a rule for choosing spells (e.g., '2 from Illusion/Enchantment').",
      "properties": {
        "count": {
          "description": "Number of spells to choose",
          "title": "Count",
          "type": "integer"
        },
        "criteria": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "$ref": "#/$defs/SpellCriteria"
            },
            {
              "type": "null"
            }
          ],
          "default": "Any",
          "description": "Restriction logic - either a simple string (e.g., 'Wizard') or a SpellCriteria object with school restrictions",
          "title": "Criteria"
        }
      },
      "required": ["count"],
      "title": "SpellChoice",
      "type": "object"
    },
    "SpellCriteria": {
      "description": "Complex spell selection criteria with school restrictions.",
      "properties": {
        "spell_list": {
          "description": "The spell list to choose from (e.g., 'Wizard')",
          "title": "Spell List",
          "type": "string"
        },
        "schools": {
          "description": "Allowed spell schools (e.g., ['Enchantment', 'Illusion'])",
          "items": {
            "type": "string"
          },
          "title": "Schools",
          "type": "array"
        }
      },
      "required": ["spell_list"],
      "title": "SpellCriteria",
      "type": "object"
    },
    "Spellcasting": {
      "description": "Spellcasting information for a class.",
      "properties": {
        "ability": {
          "$ref": "common.schema.json#/$defs/Ability",
          "description": "Spellcasting ability score"
        },
        "type": {
          "$ref": "#/$defs/SpellcastingType",
          "description": "How the class learns/prepares spells"
        },
        "cantrips_known": {
          "anyOf": [
            {
              "additionalProperties": {
                "$ref": "#/$defs/LevelSpells"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Cantrip progression: Level -> Knowledge Data",
          "title": "Cantrips Known"
        },
        "spells_known": {
          "anyOf": [
            {
              "additionalProperties": {
                "$ref": "#/$defs/LevelSpells"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Leveled spell progression: Level -> Knowledge Data",
          "title": "Spells Known"
        },
        "spell_slots": {
          "additionalProperties": {
            "additionalProperties": {
              "type": "integer"
            },
            "type": "object"
          },
          "description": "Spell slots per level",
          "title": "Spell Slots",
          "type": "object"
        },
        "ritual_casting": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether the class can ritual cast",
          "title": "Ritual Casting"
        },
        "spellbook": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether the class uses a spellbook",
          "title": "Spellbook"
        },
        "spells_prepared_formula": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Formula for calculating prepared spells (e.g., 'level + Intelligence modifier')",
          "title": "Spells Prepared Formula"
        }
      },
      "required": ["ability", "type", "spell_slots"],
      "title": "Spellcasting",
      "type": "object"
    },
    "SpellcastingType": {
      "enum": ["prepared", "known", "ritual", "pact_magic"],
      "title": "SpellcastingType",
      "type": "string"
    },
    "Subclass": {
      "description": "A subclass (archetype) for a class.",
      "properties": {
        "name": {
          "description": "Subclass name",
          "title": "Name",
          "type": "string"
        },
        "source": {
          "description": "Source book",
          "title": "Source",
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Flavor text for the subclass",
          "title": "Description"
        },
        "level": {
          "description": "Level at which subclass is chosen",
          "maximum": 20,
          "minimum": 1,
          "title": "Level",
          "type": "integer"
        },
        "resource_pools": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/ResourcePool"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Subclass-specific resource pools (e.g., Superiority Dice for Battle Master)",
          "title": "Resource Pools"
        },
        "features": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/ClassFeature"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Subclass-specific features",
          "title": "Features"
        }
      },
      "required": ["name", "source", "level"],
      "title": "Subclass",
      "type": "object"
    },
    "Subfeature": {
      "description": "A sub-feature or option within a class feature.",
      "properties": {
        "name": {
          "description": "Sub-feature name",
          "title": "Name",
          "type": "string"
        },
        "description": {
          "description": "Sub-feature description",
          "title": "Description",
          "type": "string"
        },
        "mechanics": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "action": "#/$defs/BaseMechanic",
                    "advantage": "#/$defs/BaseMechanic",
                    "bonus_action": "#/$defs/BaseMechanic",
                    "choice": "#/$defs/ChoiceMechanic",
                    "critical_hit": "#/$defs/BaseMechanic",
                    "damage_bonus": "#/$defs/BaseMechanic",
                    "extra_attack": "#/$defs/BaseMechanic",
                    "extra_turn": "#/$defs/BaseMechanic",
                    "granted_spells": "#/$defs/GrantedSpellsMechanic",
                    "immunity": "#/$defs/BaseMechanic",
                    "movement": "#/$defs/BaseMechanic",
                    "optional": "#/$defs/BaseMechanic",
                    "passive": "#/$defs/BaseMechanic",
                    "proficiency": "#/$defs/ProficiencyMechanic",
                    "reaction": "#/$defs/BaseMechanic",
                    "resistance": "#/$defs/BaseMechanic",
                    "resource": "#/$defs/ResourceMechanic",
                    "retrain": "#/$defs/RetrainMechanic",
                    "ritual": "#/$defs/BaseMechanic",
                    "special": "#/$defs/BaseMechanic",
                    "spellcasting": "#/$defs/SpellcastingMechanic"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "common.schema.json#/$defs/ResourceMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/ChoiceMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/RetrainMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/SpellcastingMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/GrantedSpellsMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/ProficiencyMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/BaseMechanic"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Mechanics for this sub-feature",
          "title": "Mechanics"
        }
      },
      "required": ["name", "description"],
      "title": "Subfeature",
      "type": "object"
    },
    "ToolProficiencyChoice": {
      "description": "A tool proficiency choice from a category.",
      "properties": {
        "type": {
          "const": "choice",
          "default": "choice",
          "title": "Type",
          "type": "string"
        },
        "choose": {
          "default": 1,
          "description": "Number of tools to choose",
          "title": "Choose",
          "type": "integer"
        },
        "from": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "description": "Category or list of options to choose from",
          "title": "From"
        }
      },
      "required": ["from"],
      "title": "ToolProficiencyChoice",
      "type": "object"
    }
  }
}
