{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "D&D 5e Class Features",
  "type": "array",
  "items": {
    "description": "A class feature with full details and mechanics.",
    "properties": {
      "id": {
        "description": "Unique prefixed slug ID",
        "title": "Id",
        "type": "string"
      },
      "name": {
        "description": "Feature name",
        "title": "Name",
        "type": "string"
      },
      "level": {
        "anyOf": [
          {
            "type": "integer"
          },
          {
            "items": {
              "type": "integer"
            },
            "type": "array"
          }
        ],
        "description": "Level(s) at which feature is gained",
        "title": "Level"
      },
      "description": {
        "description": "Full text description of the feature",
        "title": "Description",
        "type": "string"
      },
      "mechanics": {
        "description": "Structured game mechanics for this feature",
        "items": {
          "discriminator": {
            "mapping": {
              "action": "#/$defs/BaseMechanic",
              "advantage": "#/$defs/BaseMechanic",
              "bonus_action": "#/$defs/BaseMechanic",
              "choice": "#/$defs/ChoiceMechanic",
              "critical_hit": "#/$defs/BaseMechanic",
              "damage_bonus": "#/$defs/BaseMechanic",
              "extra_attack": "#/$defs/BaseMechanic",
              "extra_turn": "#/$defs/BaseMechanic",
              "granted_spells": "#/$defs/GrantedSpellsMechanic",
              "immunity": "#/$defs/BaseMechanic",
              "movement": "#/$defs/BaseMechanic",
              "optional": "#/$defs/BaseMechanic",
              "passive": "#/$defs/BaseMechanic",
              "proficiency": "#/$defs/ProficiencyMechanic",
              "reaction": "#/$defs/BaseMechanic",
              "resistance": "#/$defs/BaseMechanic",
              "resource": "#/$defs/ResourceMechanic",
              "retrain": "#/$defs/RetrainMechanic",
              "ritual": "#/$defs/BaseMechanic",
              "special": "#/$defs/BaseMechanic",
              "spellcasting": "#/$defs/SpellcastingMechanic"
            },
            "propertyName": "type"
          },
          "oneOf": [
            {
              "$ref": "common.schema.json#/$defs/ResourceMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/ChoiceMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/RetrainMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/SpellcastingMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/GrantedSpellsMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/ProficiencyMechanic"
            },
            {
              "$ref": "common.schema.json#/$defs/BaseMechanic"
            }
          ]
        },
        "title": "Mechanics",
        "type": "array"
      },
      "class": {
        "description": "Class this feature belongs to",
        "title": "Class",
        "type": "string"
      },
      "source": {
        "description": "Source book or material",
        "title": "Source",
        "type": "string"
      },
      "ruleset": {
        "description": "Ruleset for the feature",
        "title": "Ruleset",
        "type": "string"
      },
      "triggered_by": {
        "anyOf": [
          {
            "type": "string"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Name of another feature that triggers this feature (e.g., 'Ability Score Improvement')",
        "title": "Triggered By"
      },
      "extends": {
        "anyOf": [
          {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "List of parent feature names this feature builds on. Both the parent and this feature appear as separate actions in the action list (e.g., Frenzy extends Rage \u2014 both are available).",
        "title": "Extends"
      },
      "enhances": {
        "anyOf": [
          {
            "type": "string"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Name of feature this feature modifies in place. Only the base feature appears in the action list; the enhancement upgrades its behavior (e.g., Destroy Undead enhances Turn Undead, Persistent Rage enhances Rage).",
        "title": "Enhances"
      },
      "subfeatures": {
        "anyOf": [
          {
            "items": {
              "$ref": "#/$defs/Subfeature"
            },
            "type": "array"
          },
          {
            "type": "null"
          }
        ],
        "default": null,
        "description": "Sub-features or options within this feature",
        "title": "Subfeatures"
      }
    },
    "required": ["id", "name", "level", "description", "mechanics", "class", "source", "ruleset"],
    "additionalProperties": false,
    "title": "ClassFeature",
    "type": "object"
  },
  "$defs": {
    "Subfeature": {
      "description": "A sub-feature or option within a class feature.",
      "properties": {
        "name": {
          "description": "Sub-feature name",
          "title": "Name",
          "type": "string"
        },
        "description": {
          "description": "Sub-feature description",
          "title": "Description",
          "type": "string"
        },
        "mechanics": {
          "anyOf": [
            {
              "items": {
                "discriminator": {
                  "mapping": {
                    "action": "#/$defs/BaseMechanic",
                    "advantage": "#/$defs/BaseMechanic",
                    "bonus_action": "#/$defs/BaseMechanic",
                    "choice": "#/$defs/ChoiceMechanic",
                    "critical_hit": "#/$defs/BaseMechanic",
                    "damage_bonus": "#/$defs/BaseMechanic",
                    "extra_attack": "#/$defs/BaseMechanic",
                    "extra_turn": "#/$defs/BaseMechanic",
                    "granted_spells": "#/$defs/GrantedSpellsMechanic",
                    "immunity": "#/$defs/BaseMechanic",
                    "movement": "#/$defs/BaseMechanic",
                    "optional": "#/$defs/BaseMechanic",
                    "passive": "#/$defs/BaseMechanic",
                    "proficiency": "#/$defs/ProficiencyMechanic",
                    "reaction": "#/$defs/BaseMechanic",
                    "resistance": "#/$defs/BaseMechanic",
                    "resource": "#/$defs/ResourceMechanic",
                    "retrain": "#/$defs/RetrainMechanic",
                    "ritual": "#/$defs/BaseMechanic",
                    "special": "#/$defs/BaseMechanic",
                    "spellcasting": "#/$defs/SpellcastingMechanic"
                  },
                  "propertyName": "type"
                },
                "oneOf": [
                  {
                    "$ref": "common.schema.json#/$defs/ResourceMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/ChoiceMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/RetrainMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/SpellcastingMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/GrantedSpellsMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/ProficiencyMechanic"
                  },
                  {
                    "$ref": "common.schema.json#/$defs/BaseMechanic"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Mechanics for this sub-feature",
          "title": "Mechanics"
        }
      },
      "required": ["name", "description"],
      "title": "Subfeature",
      "type": "object"
    }
  }
}
